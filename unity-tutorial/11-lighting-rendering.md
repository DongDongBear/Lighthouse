# ç¬¬ 11 ç« ï¼šURP å…‰ç…§ä¸æ¸²æŸ“ç®¡çº¿

> **å‰ç«¯ç±»æ¯”**ï¼šå¦‚æœæŠŠæ¸¸æˆç”»é¢æ¯”ä½œä¸€ä¸ªç½‘é¡µï¼Œé‚£ä¹ˆæ¸²æŸ“ç®¡çº¿ï¼ˆRender Pipelineï¼‰å°±æ˜¯æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ï¼Œå…‰ç…§æ˜¯ CSS çš„ `filter` å’Œ `box-shadow`ï¼Œåå¤„ç†æ•ˆæœæ˜¯ Instagram æ»¤é•œï¼Œè€Œ Shader å°±æ˜¯ WebGL Shaderâ€”â€”ä½ å¯èƒ½å†™è¿‡ `mix-blend-mode` å’Œ `backdrop-filter`ï¼Œä½† Unity çš„æ¸²æŸ“ç³»ç»Ÿè¿œæ¯” CSS å¼ºå¤§å’Œå¤æ‚ã€‚

---

## æœ¬ç« ç›®æ ‡

å®Œæˆæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š

1. ç†è§£ URPï¼ˆUniversal Render Pipelineï¼‰çš„æ¶æ„å’Œé…ç½®
2. é…ç½® URP Pipeline Asset çš„å„é¡¹å‚æ•°
3. æŒæ¡å››ç§å…‰æºç±»å‹åŠå…¶é€‚ç”¨åœºæ™¯
4. åŒºåˆ†å®æ—¶å…‰ç…§ä¸çƒ˜ç„™å…‰ç…§ï¼Œåˆç†é€‰æ‹©
5. ç†è§£ Lightmap å…‰ç…§è´´å›¾çš„çƒ˜ç„™æµç¨‹
6. ä½¿ç”¨ Reflection Probe å’Œ Light Probe ä¼˜åŒ–åŠ¨æ€ç‰©ä½“å…‰ç…§
7. æ­£ç¡®é…ç½®é˜´å½±ç³»ç»Ÿï¼ˆåˆ†è¾¨ç‡ã€è·ç¦»ã€çº§è”ï¼‰
8. ä½¿ç”¨ Post-Processing Volume æ·»åŠ è§†è§‰æ•ˆæœ
9. å…¥é—¨ Shader Graphï¼ˆåˆ›å»ºç®€å•çš„è‡ªå®šä¹‰ Shaderï¼‰
10. ç†è§£ PBR æè´¨ç³»ç»Ÿï¼ˆAlbedoã€Normal Mapã€Metallicã€Emissionï¼‰
11. é…ç½® Camera Stackingï¼ˆç›¸æœºå †å ï¼‰

## é¢„è®¡å­¦ä¹ æ—¶é—´

**6 å°æ—¶**ï¼ˆç†è®º 2 å°æ—¶ + å®æ“ 4 å°æ—¶ï¼‰

---

## 11.1 æ¸²æŸ“ç®¡çº¿æ¦‚è¿°

### 11.1.1 ä»€ä¹ˆæ˜¯æ¸²æŸ“ç®¡çº¿

æ¸²æŸ“ç®¡çº¿ï¼ˆRender Pipelineï¼‰å†³å®šäº† Unity å¦‚ä½•å°† 3D åœºæ™¯ç»˜åˆ¶åˆ°å±å¹•ä¸Šâ€”â€”åŒ…æ‹¬å…‰ç…§è®¡ç®—æ–¹å¼ã€é˜´å½±ç®—æ³•ã€åå¤„ç†æµç¨‹ç­‰ã€‚

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šæ¸²æŸ“ç®¡çº¿ç±»ä¼¼æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“é€‰æ‹©ã€‚Chrome ç”¨ Blinkï¼ŒFirefox ç”¨ Geckoï¼ŒSafari ç”¨ WebKitâ€”â€”ä¸åŒå¼•æ“çš„æ¸²æŸ“ç­–ç•¥å’Œæ€§èƒ½ç‰¹å¾ä¸åŒã€‚Unity çš„æ¸²æŸ“ç®¡çº¿é€‰æ‹©åŒç†ã€‚

### 11.1.2 Unity çš„ä¸‰ç§æ¸²æŸ“ç®¡çº¿

| æ¸²æŸ“ç®¡çº¿ | å…¨ç§° | å®šä½ | é€‚ç”¨å¹³å° |
|---------|------|------|---------|
| **Built-in** | Built-in Render Pipeline | æ—§ç‰ˆé»˜è®¤ç®¡çº¿ | é€šç”¨ï¼ˆé—ç•™é¡¹ç›®ï¼‰ |
| **URP** | Universal Render Pipeline | æ€§èƒ½ä¼˜å…ˆçš„é€šç”¨ç®¡çº¿ | ç§»åŠ¨ç«¯ + PC + ä¸»æœº |
| **HDRP** | High Definition Render Pipeline | ç”»è´¨ä¼˜å…ˆçš„é«˜ç«¯ç®¡çº¿ | é«˜ç«¯ PC + ä¸»æœº |

```
é€‰æ‹©æ¸²æŸ“ç®¡çº¿çš„å†³ç­–ï¼š

å¼€å‘æ‰‹æ¸¸ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ URPï¼ˆæœ¬æ•™ç¨‹ä½¿ç”¨ï¼‰
â”‚         æ€§èƒ½ä¼˜ç§€ï¼ŒåŠŸèƒ½å¤Ÿç”¨
â”‚
â””â”€â”€ å¦ â†’ è¿½æ±‚ 3A ç”»è´¨ï¼Ÿ
          â”œâ”€â”€ æ˜¯ â†’ HDRP
          â”‚         é€‚åˆé«˜ç«¯å¹³å°
          â”‚
          â””â”€â”€ å¦ â†’ URPï¼ˆå¤§å¤šæ•°æƒ…å†µæœ€ä½³é€‰æ‹©ï¼‰
```

> ğŸ¯ **æœ€ä½³å®è·µ**ï¼šå¯¹äºæ‰‹æ¸¸å¼€å‘ï¼Œ**å§‹ç»ˆé€‰æ‹© URP**ã€‚å®ƒåœ¨ä¿è¯ç”»é¢è´¨é‡çš„åŒæ—¶ï¼Œå¯¹ç§»åŠ¨ç«¯ GPU åšäº†å¤§é‡ä¼˜åŒ–ã€‚

### 11.1.3 URP vs Built-in çš„ä¸»è¦åŒºåˆ«

| æ–¹é¢ | Built-in | URP |
|------|----------|-----|
| Shader è¯­è¨€ | Surface Shader / HLSL | Shader Graph / HLSL |
| å‰å‘æ¸²æŸ“ç¯å…‰æ•°é‡ | æŒ‰åƒç´ å…‰æº (Per-Pixel) é™åˆ¶ | Single Passï¼Œé«˜æ•ˆå¤šå…‰æºå¤„ç† |
| åå¤„ç† | éœ€è¦é¢å¤–åŒ… (Post Processing Stack) | å†…ç½® Volume ç³»ç»Ÿ |
| SRP Batcher | ä¸æ”¯æŒ | æ”¯æŒï¼ˆå¤§å¹…å‡å°‘ Draw Callï¼‰ |
| å¯ç¼–ç¨‹æ€§ | ä¸å¯ç¼–ç¨‹ | å¯ç¼–ç¨‹ï¼ˆRender Featuresï¼‰ |
| æ€§èƒ½ | ä¸€èˆ¬ | ç§»åŠ¨ç«¯ä¼˜åŒ–æ›´å¥½ |

---

## 11.2 URP é¡¹ç›®è®¾ç½®

### 11.2.1 æ–°é¡¹ç›®ç›´æ¥ä½¿ç”¨ URP

åˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼Œåœ¨ Unity Hub ä¸­é€‰æ‹© **3D (URP)** æ¨¡æ¿å³å¯ã€‚

[æˆªå›¾ï¼šUnity Hub æ–°å»ºé¡¹ç›®æ—¶é€‰æ‹© 3D (URP) æ¨¡æ¿]

### 11.2.2 ç°æœ‰é¡¹ç›®å‡çº§åˆ° URP

å¦‚æœä½ çš„é¡¹ç›®æ˜¯ Built-in ç®¡çº¿ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤å‡çº§ï¼š

**æ­¥éª¤ 1ï¼šå®‰è£… URP åŒ…**
1. èœå• â†’ `Window` â†’ `Package Manager`
2. æœç´¢ `Universal RP`
3. ç‚¹å‡» `Install`

**æ­¥éª¤ 2ï¼šåˆ›å»º URP Pipeline Asset**
1. Project çª—å£å³é”® â†’ `Create` â†’ `Rendering` â†’ `URP Asset (with Universal Renderer)`
2. è¿™ä¼šåˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼š
   - `URP-Pipeline.asset`ï¼ˆPipeline Assetï¼‰
   - `URP-Pipeline_Renderer.asset`ï¼ˆRenderer Dataï¼‰

[æˆªå›¾ï¼šProject çª—å£ä¸­æ–°åˆ›å»ºçš„ URP Pipeline Asset å’Œ Renderer Data]

**æ­¥éª¤ 3ï¼šåº”ç”¨ URP Pipeline**
1. èœå• â†’ `Edit` â†’ `Project Settings` â†’ `Graphics`
2. å°† `Scriptable Render Pipeline Settings` è®¾ä¸ºåˆšåˆ›å»ºçš„ `URP-Pipeline.asset`

[æˆªå›¾ï¼šGraphics Settings ä¸­è®¾ç½® Scriptable Render Pipeline Settings]

**æ­¥éª¤ 4ï¼šå‡çº§æè´¨**
1. èœå• â†’ `Edit` â†’ `Rendering` â†’ `Materials` â†’ `Convert Built-in Materials to URP`
2. è¿™ä¼šæŠŠæ—§çš„ Standard Shader è½¬ä¸º URP çš„ Universal Lit Shader

> âš ï¸ **æ³¨æ„**ï¼šå‡çº§åæ—§çš„ Standard Shader æè´¨å¯èƒ½æ˜¾ç¤ºä¸ºç²‰è‰²ï¼ˆç€è‰²å™¨ä¸å…¼å®¹ï¼‰ï¼Œéœ€è¦è½¬æ¢æˆ–æ‰‹åŠ¨é‡æ–°æŒ‡å®š Shaderã€‚

### 11.2.3 URP Pipeline Asset é…ç½®è¯¦è§£

é€‰ä¸­ URP Pipeline Assetï¼Œåœ¨ Inspector ä¸­é…ç½®ï¼š

[æˆªå›¾ï¼šURP Pipeline Asset çš„å®Œæ•´ Inspector é¢æ¿]

```
URP Pipeline Asset å…³é”®è®¾ç½®ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ===== Rendering =====                       â”‚
â”‚                                            â”‚
â”‚ Renderer List:                             â”‚
â”‚   [0] URP-Pipeline_Renderer                â”‚  â† é»˜è®¤æ¸²æŸ“å™¨
â”‚                                            â”‚
â”‚ Depth Texture: â˜‘                           â”‚  â† æ·±åº¦çº¹ç†ï¼ˆåå¤„ç†éœ€è¦ï¼‰
â”‚ Opaque Texture: â˜‘                          â”‚  â† ä¸é€æ˜çº¹ç†ï¼ˆæŠ˜å°„æ•ˆæœéœ€è¦ï¼‰
â”‚ Opaque Downsampling: None                  â”‚
â”‚                                            â”‚
â”‚ Terrain Holes: â˜‘                           â”‚  â† åœ°å½¢å­”æ´æ”¯æŒ
â”‚                                            â”‚
â”‚ ===== Quality =====                         â”‚
â”‚                                            â”‚
â”‚ HDR: â˜‘                                     â”‚  â† é«˜åŠ¨æ€èŒƒå›´ï¼ˆBloom ç­‰éœ€è¦ï¼‰
â”‚ Anti Aliasing (MSAA): 2x / 4x             â”‚  â† æŠ—é”¯é½¿
â”‚ Render Scale: 1.0                          â”‚  â† æ¸²æŸ“åˆ†è¾¨ç‡ç¼©æ”¾
â”‚                                            â”‚     æ‰‹æ¸¸å¯è®¾ 0.75 æå‡æ€§èƒ½
â”‚                                            â”‚
â”‚ ===== Lighting =====                        â”‚
â”‚                                            â”‚
â”‚ Main Light:                                â”‚
â”‚   Rendering Mode: Per Pixel               â”‚
â”‚   Cast Shadows: â˜‘                          â”‚
â”‚                                            â”‚
â”‚ Additional Lights:                         â”‚
â”‚   Rendering Mode: Per Pixel               â”‚  â† æˆ– Per Vertexï¼ˆæ›´çœï¼‰
â”‚   Per Object Limit: 4                     â”‚  â† æ¯ä¸ªç‰©ä½“æœ€å¤šå—å‡ ä¸ªé¢å¤–å…‰æºå½±å“
â”‚   Cast Shadows: â˜‘                          â”‚
â”‚                                            â”‚
â”‚ ===== Shadows =====                         â”‚
â”‚                                            â”‚
â”‚ Max Distance: 50                           â”‚  â† é˜´å½±æœ€è¿œè·ç¦»ï¼ˆç±³ï¼‰
â”‚ Cascade Count: 2                           â”‚  â† çº§è”é˜´å½±å±‚æ•°ï¼ˆ1-4ï¼‰
â”‚ Working Unit: Metric                       â”‚
â”‚ Depth Bias: 1                              â”‚
â”‚ Normal Bias: 1                             â”‚
â”‚                                            â”‚
â”‚ ===== Post-processing =====                â”‚
â”‚                                            â”‚
â”‚ Grading Mode: Low Dynamic Range            â”‚  â† æˆ– HDR
â”‚ LUT Size: 32                               â”‚
â”‚ Fast sRGB/Linear: â˜‘                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰‹æ¸¸æ¨èè®¾ç½®ï¼š**

| è®¾ç½®é¡¹ | ä½ç«¯æœº | ä¸­ç«¯æœº | é«˜ç«¯æœº |
|--------|--------|--------|--------|
| MSAA | Off | 2x | 4x |
| Render Scale | 0.65 | 0.85 | 1.0 |
| Additional Lights Mode | Per Vertex | Per Pixel | Per Pixel |
| Per Object Limit | 2 | 4 | 8 |
| Shadow Distance | 30 | 50 | 100 |
| Shadow Cascades | 1 | 2 | 4 |
| Shadow Resolution | 512 | 1024 | 2048 |

> ğŸ¯ **æœ€ä½³å®è·µ**ï¼šåˆ›å»ºå¤šä¸ª URP Pipeline Assetï¼ˆLowã€Mediumã€Highï¼‰ï¼Œåœ¨è¿è¡Œæ—¶æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€åˆ‡æ¢ï¼š
```csharp
// åŠ¨æ€åˆ‡æ¢ç”»è´¨
QualitySettings.SetQualityLevel(qualityIndex);
// å¯¹åº”çš„ URP Pipeline Asset åœ¨ Quality Settings ä¸­é…ç½®
```

---

## 11.3 å…‰æºç±»å‹

### 11.3.1 å››ç§å…‰æº

```
å››ç§å…‰æºç±»å‹ç¤ºæ„ï¼š

1. Directional Lightï¼ˆæ–¹å‘å…‰ï¼‰â€”â€”å¤ªé˜³
   â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“
   å¹³è¡Œå…‰çº¿ï¼Œç…§äº®æ•´ä¸ªåœºæ™¯
   ä½ç½®æ— å…³ï¼Œåªæœ‰æ–¹å‘æœ‰å½±å“

2. Point Lightï¼ˆç‚¹å…‰æºï¼‰â€”â€”ç¯æ³¡
         â•² â”‚ â•±
        â”€â”€ â— â”€â”€
         â•± â”‚ â•²
   ä»ä¸€ä¸ªç‚¹å‘æ‰€æœ‰æ–¹å‘å‘å…‰
   æœ‰èŒƒå›´ï¼ˆRangeï¼‰é™åˆ¶

3. Spot Lightï¼ˆèšå…‰ç¯ï¼‰â€”â€”æ‰‹ç”µç­’
           â”‚
          â•± â•²
         â•±   â•²
        â•±â”€â”€â”€â”€â”€â•²
   åœ†é”¥å½¢å…‰çº¿
   æœ‰èŒƒå›´ + è§’åº¦é™åˆ¶

4. Area Lightï¼ˆé¢å…‰æºï¼‰â€”â€”çª—æˆ·/ç¯ç®±ï¼ˆä»…çƒ˜ç„™ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â†“â†“â†“â†“â†“â†“â†“â†“ â”‚
   â”‚ â†“â†“â†“â†“â†“â†“â†“â†“ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ä»ä¸€ä¸ªé¢å‘å‡ºæŸ”å’Œå…‰çº¿
   åªæ”¯æŒçƒ˜ç„™å…‰ç…§
```

### 11.3.2 å„å…‰æºå±æ€§

**åˆ›å»ºå…‰æºï¼š** Hierarchy â†’ å³é”® â†’ `Light` â†’ é€‰æ‹©å…‰æºç±»å‹

[æˆªå›¾ï¼šDirectional Light çš„ Inspector é¢æ¿ï¼Œæ ‡æ³¨å„å±æ€§]

| å±æ€§ | Directional | Point | Spot | Area |
|------|:-----------:|:-----:|:----:|:----:|
| Color | å…‰çº¿é¢œè‰² | å…‰çº¿é¢œè‰² | å…‰çº¿é¢œè‰² | å…‰çº¿é¢œè‰² |
| Intensity | å¼ºåº¦ | å¼ºåº¦ | å¼ºåº¦ | å¼ºåº¦ |
| Range | -- | èŒƒå›´(ç±³) | èŒƒå›´(ç±³) | -- |
| Spot Angle | -- | -- | é”¥è§’(åº¦) | -- |
| Shadow Type | æœ‰ | æœ‰ | æœ‰ | ä»…çƒ˜ç„™ |
| å®æ—¶ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ |
| çƒ˜ç„™ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| æ€§èƒ½å¼€é”€ | ä½(åªæœ‰ä¸€ä¸ª) | ä¸­ | ä¸­ | æ— å®æ—¶å¼€é”€ |

### 11.3.3 å…‰æºæ¨¡å¼

æ¯ä¸ªå…‰æºå¯ä»¥è®¾ç½®ä¸‰ç§æ¨¡å¼ï¼š

| æ¨¡å¼ | è¯´æ˜ | æ€§èƒ½ | é€‚ç”¨ |
|------|------|------|------|
| Realtime | å®æ—¶è®¡ç®—å…‰ç…§ | é«˜ | ä¼šç§»åŠ¨æˆ–å˜åŒ–çš„å…‰æº |
| Mixed | æ··åˆâ€”â€”é—´æ¥å…‰çƒ˜ç„™ï¼Œç›´æ¥å…‰å®æ—¶ | ä¸­ | ä¸ç§»åŠ¨ä½†éœ€è¦å®æ—¶é˜´å½±çš„å…‰æº |
| Baked | å®Œå…¨çƒ˜ç„™â€”â€”å…‰ç…§ä¿¡æ¯å­˜å‚¨ä¸ºçº¹ç† | ä½ | æ°¸è¿œä¸å˜çš„å…‰æºï¼ˆæ¨èå¤§é‡ä½¿ç”¨ï¼‰ |

```
å…‰æºæ¨¡å¼å¯¹æ¯”ï¼š

Realtimeï¼ˆå®æ—¶ï¼‰ï¼š
  ä¼˜ç‚¹ï¼šå®Œå…¨åŠ¨æ€ï¼Œæ‰€æœ‰å˜åŒ–éƒ½å®æ—¶åæ˜ 
  ç¼ºç‚¹ï¼šæ€§èƒ½å¼€é”€å¤§ï¼Œé—´æ¥å…‰ç…§è´¨é‡æœ‰é™
  ç”¨äºï¼šå¤ªé˜³ï¼ˆéœ€è¦æ˜¼å¤œå¾ªç¯ï¼‰ã€å¯ç§»åŠ¨çš„ç¯

Mixedï¼ˆæ··åˆï¼‰ï¼š
  ä¼˜ç‚¹ï¼šé—´æ¥å…‰ç…§è´¨é‡é«˜ï¼Œç›´æ¥å…‰ç…§å¯è°ƒèŠ‚
  ç¼ºç‚¹ï¼šéœ€è¦çƒ˜ç„™ï¼Œçƒ˜ç„™åé—´æ¥å…‰ä¸èƒ½æ”¹å˜
  ç”¨äºï¼šå›ºå®šä½ç½®ä½†éœ€è¦å®æ—¶é˜´å½±çš„ç¯

Bakedï¼ˆçƒ˜ç„™ï¼‰ï¼š
  ä¼˜ç‚¹ï¼šæ€§èƒ½å‡ ä¹é›¶å¼€é”€ï¼Œå…‰ç…§è´¨é‡é«˜
  ç¼ºç‚¹ï¼šå®Œå…¨é™æ€ï¼Œä¸èƒ½å½±å“åŠ¨æ€ç‰©ä½“
  ç”¨äºï¼šå»ºç­‘å†…ç¯å…‰ã€è£…é¥°ç¯ã€æ°¸ä¹…æ€§å…‰æº
```

### 11.3.4 å…‰æºè®¾ç½®ä»£ç 

```csharp
using UnityEngine;

/// <summary>
/// åŠ¨æ€å…‰æºæ§åˆ¶ç¤ºä¾‹
/// ä¾‹å¦‚ï¼šæ˜¼å¤œå¾ªç¯ä¸­çš„å¤ªé˜³å…‰å˜åŒ–
/// </summary>
public class DynamicLightController : MonoBehaviour
{
    [Header("å¤ªé˜³å…‰å¼•ç”¨")]
    [SerializeField] private Light directionalLight;

    [Header("æ˜¼å¤œé¢œè‰²è®¾ç½®")]
    [SerializeField] private Color dawnColor = new Color(1f, 0.6f, 0.3f);    // é»æ˜â€”â€”æš–æ©™è‰²
    [SerializeField] private Color noonColor = new Color(1f, 0.96f, 0.9f);   // æ­£åˆâ€”â€”ç™½è‰²åæš–
    [SerializeField] private Color duskColor = new Color(1f, 0.4f, 0.2f);    // é»„æ˜â€”â€”æ·±æ©™è‰²
    [SerializeField] private Color nightColor = new Color(0.1f, 0.1f, 0.3f); // å¤œæ™šâ€”â€”æ·±è“è‰²

    [Header("å¤ªé˜³å¼ºåº¦")]
    [SerializeField] private float noonIntensity = 1.5f;
    [SerializeField] private float nightIntensity = 0.05f;

    /// <summary>
    /// æ ¹æ®æ¸¸æˆæ—¶é—´æ›´æ–°å¤ªé˜³å…‰
    /// </summary>
    /// <param name="timeOfDay">ä¸€å¤©ä¸­çš„æ—¶é—´ (0-24 å°æ—¶)</param>
    public void UpdateSunLight(float timeOfDay)
    {
        // è®¡ç®—å¤ªé˜³è§’åº¦ï¼ˆ0 ç‚¹åœ¨æ­£ä¸‹æ–¹ï¼Œ12 ç‚¹åœ¨æ­£ä¸Šæ–¹ï¼‰
        float sunAngle = (timeOfDay / 24f) * 360f - 90f;
        directionalLight.transform.rotation = Quaternion.Euler(sunAngle, 170f, 0f);

        // æ ¹æ®æ—¶é—´æ’å€¼é¢œè‰²
        Color sunColor;
        float intensity;

        if (timeOfDay < 6f) // å¤œæ™š â†’ é»æ˜ (0-6)
        {
            float t = timeOfDay / 6f;
            sunColor = Color.Lerp(nightColor, dawnColor, t);
            intensity = Mathf.Lerp(nightIntensity, noonIntensity * 0.5f, t);
        }
        else if (timeOfDay < 12f) // é»æ˜ â†’ æ­£åˆ (6-12)
        {
            float t = (timeOfDay - 6f) / 6f;
            sunColor = Color.Lerp(dawnColor, noonColor, t);
            intensity = Mathf.Lerp(noonIntensity * 0.5f, noonIntensity, t);
        }
        else if (timeOfDay < 18f) // æ­£åˆ â†’ é»„æ˜ (12-18)
        {
            float t = (timeOfDay - 12f) / 6f;
            sunColor = Color.Lerp(noonColor, duskColor, t);
            intensity = Mathf.Lerp(noonIntensity, noonIntensity * 0.5f, t);
        }
        else // é»„æ˜ â†’ å¤œæ™š (18-24)
        {
            float t = (timeOfDay - 18f) / 6f;
            sunColor = Color.Lerp(duskColor, nightColor, t);
            intensity = Mathf.Lerp(noonIntensity * 0.5f, nightIntensity, t);
        }

        directionalLight.color = sunColor;
        directionalLight.intensity = intensity;
    }
}
```

---

## 11.4 å®æ—¶å…‰ç…§ vs çƒ˜ç„™å…‰ç…§

### 11.4.1 ä¸ºä»€ä¹ˆéœ€è¦çƒ˜ç„™å…‰ç…§

å®æ—¶è®¡ç®—é—´æ¥å…‰ç…§ï¼ˆå…‰çº¿åå¼¹ã€å…¨å±€å…‰ç…§ï¼‰éå¸¸æ˜‚è´µï¼Œç§»åŠ¨ç«¯å‡ ä¹ä¸å¯èƒ½å®æ—¶è®¡ç®—ã€‚è§£å†³æ–¹æ¡ˆæ˜¯**é¢„å…ˆè®¡ç®—ï¼ˆçƒ˜ç„™ï¼‰**è¿™äº›å…‰ç…§ä¿¡æ¯ï¼Œå­˜å‚¨ä¸ºçº¹ç†ï¼ˆLightmapï¼‰ã€‚

```
å®æ—¶ vs çƒ˜ç„™å…‰ç…§å¯¹æ¯”ï¼š

å®æ—¶å…‰ç…§ï¼š
  æ¯ä¸€å¸§ GPU éƒ½è®¡ç®—å…‰ç…§ â†’ æ€§èƒ½å¼€é”€å¤§
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å…‰æº â†’ GPU  â”‚â”€â”€â†’ ç›´æ¥ç…§æ˜ âœ“
  â”‚ æ¯å¸§è®¡ç®—    â”‚â”€â”€â†’ é—´æ¥ç…§æ˜ âœ—ï¼ˆå¤ªè´µï¼‰
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çƒ˜ç„™å…‰ç…§ï¼š
  ç¦»çº¿é¢„è®¡ç®— â†’ å­˜å‚¨ä¸ºçº¹ç† â†’ è¿è¡Œæ—¶å‡ ä¹æ— å¼€é”€
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ç¦»çº¿è®¡ç®—    â”‚â”€â”€â†’ â”‚ Lightmap çº¹ç†â”‚â”€â”€â†’ ç›´æ¥ç…§æ˜ âœ“
  â”‚ï¼ˆçƒ˜ç„™è¿‡ç¨‹ï¼‰ â”‚    â”‚ ï¼ˆé¢„è®¡ç®—å¥½çš„ï¼‰â”‚â”€â”€â†’ é—´æ¥ç…§æ˜ âœ“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç¼ºç‚¹ï¼šåªèƒ½ç…§äº®é™æ€ç‰©ä½“ï¼Œå å­˜å‚¨ç©ºé—´
```

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šçƒ˜ç„™å…‰ç…§ç±»ä¼¼ SSGï¼ˆStatic Site Generationï¼‰â€”â€”é¢„å…ˆç”Ÿæˆå¥½å†…å®¹ï¼ˆå…‰ç…§ï¼‰ï¼Œè¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨ï¼Œæ€§èƒ½æä½³ä½†ä¸å¤ŸåŠ¨æ€ã€‚å®æ—¶å…‰ç…§ç±»ä¼¼ SSRï¼ˆServer-Side Renderingï¼‰â€”â€”æ¯æ¬¡è¯·æ±‚éƒ½è®¡ç®—ï¼Œçµæ´»ä½†å¼€é”€å¤§ã€‚

### 11.4.2 è®¾ç½®é™æ€ç‰©ä½“

åªæœ‰æ ‡è®°ä¸º **Static** çš„ç‰©ä½“æ‰èƒ½æ¥æ”¶çƒ˜ç„™å…‰ç…§ã€‚

1. é€‰ä¸­åœºæ™¯ä¸­çš„é™æ€ç‰©ä½“ï¼ˆåœ°é¢ã€å»ºç­‘ã€çŸ³å¤´ç­‰ï¼‰
2. åœ¨ Inspector é¡¶éƒ¨å‹¾é€‰ `Static` â†’ é€‰æ‹© `Contribute GI`

[æˆªå›¾ï¼šInspector é¡¶éƒ¨çš„ Static ä¸‹æ‹‰èœå•ï¼Œæ ‡æ³¨ Contribute GI é€‰é¡¹]

```
Static æ ‡è®°çš„ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜‘ Contribute GI       â† å‚ä¸å…¨å±€å…‰ç…§çƒ˜ç„™ï¼ˆæœ€é‡è¦ï¼‰
â”‚ â˜‘ Occluder Static      â† ä½œä¸ºé®æŒ¡å‰”é™¤çš„é®æŒ¡ç‰©
â”‚ â˜‘ Occludee Static      â† ä½œä¸ºé®æŒ¡å‰”é™¤çš„è¢«é®æŒ¡ç‰©
â”‚ â˜‘ Batching Static      â† å‚ä¸é™æ€æ‰¹å¤„ç†ï¼ˆä¼˜åŒ– Draw Callï¼‰
â”‚ â˜‘ Navigation Static    â† å‚ä¸ NavMesh å¯¼èˆªçƒ˜ç„™
â”‚ â˜‘ Reflection Probe Static â† å‚ä¸åå°„æ¢é’ˆçƒ˜ç„™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.4.3 çƒ˜ç„™å…‰ç…§è´´å›¾

1. èœå• â†’ `Window` â†’ `Rendering` â†’ `Lighting`
2. åœ¨ Lighting çª—å£ä¸­åˆ‡æ¢åˆ° `Baked Lightmaps` æ ‡ç­¾
3. é…ç½®çƒ˜ç„™å‚æ•°

[æˆªå›¾ï¼šLighting çª—å£çš„å®Œæ•´ç•Œé¢]

```
Lightmap çƒ˜ç„™è®¾ç½®ï¼ˆæ‰‹æ¸¸æ¨èï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ===== Lightmapper =====              â”‚
â”‚                                      â”‚
â”‚ Lightmapper: Progressive GPU        â”‚  â† ä½¿ç”¨ GPU åŠ é€Ÿçƒ˜ç„™ï¼ˆæ¨èï¼‰
â”‚                                      â”‚
â”‚ ===== Lightmap Resolution =====      â”‚
â”‚                                      â”‚
â”‚ Lightmap Resolution: 20             â”‚  â† æ¯å•ä½åƒç´ æ•°
â”‚                                      â”‚     æ‰‹æ¸¸ç”¨ 10-20ï¼ŒPC ç”¨ 40+
â”‚ Lightmap Padding: 2                  â”‚
â”‚ Max Lightmap Size: 1024             â”‚  â† å•å¼  Lightmap æœ€å¤§å°ºå¯¸
â”‚                                      â”‚     æ‰‹æ¸¸ç”¨ 1024ï¼ŒPC ç”¨ 2048
â”‚ Lightmap Compression: Normal         â”‚
â”‚ Compress Lightmaps: â˜‘                â”‚
â”‚                                      â”‚
â”‚ ===== Indirect Lighting =====        â”‚
â”‚                                      â”‚
â”‚ Indirect Intensity: 1               â”‚  â† é—´æ¥å…‰å¼ºåº¦
â”‚ Indirect Resolution: 2              â”‚
â”‚ Environment Lighting: Skybox         â”‚
â”‚                                      â”‚
â”‚ ===== Bounces =====                  â”‚
â”‚                                      â”‚
â”‚ Max Bounces: 2                       â”‚  â† å…‰çº¿åå¼¹æ¬¡æ•°
â”‚                                      â”‚     è¶Šå¤šè¶ŠçœŸå®ä½†è¶Šæ…¢
â”‚                                      â”‚     æ‰‹æ¸¸ç”¨ 2ï¼ŒPC ç”¨ 3-4
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

4. ç‚¹å‡» `Generate Lighting` å¼€å§‹çƒ˜ç„™
5. çƒ˜ç„™å®Œæˆåï¼Œä¼šåœ¨åœºæ™¯åŒåæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ Lightmap çº¹ç†

[æˆªå›¾ï¼šçƒ˜ç„™å®Œæˆåçš„åœºæ™¯æ•ˆæœå¯¹æ¯”â€”â€”çƒ˜ç„™å‰ï¼ˆæ— é—´æ¥å…‰ï¼‰vs çƒ˜ç„™åï¼ˆæœ‰é—´æ¥å…‰ï¼‰]

> âš ï¸ **æ³¨æ„**ï¼šçƒ˜ç„™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ ååˆ†é’Ÿï¼ˆå–å†³äºåœºæ™¯å¤æ‚åº¦å’Œå‚æ•°ï¼‰ã€‚å¼€å‘é˜¶æ®µå¯ä»¥é™ä½åˆ†è¾¨ç‡å’Œåå¼¹æ¬¡æ•°æ¥åŠ é€Ÿã€‚

---

## 11.5 åå°„æ¢é’ˆï¼ˆReflection Probeï¼‰å’Œå…‰æ¢é’ˆï¼ˆLight Probeï¼‰

### 11.5.1 ä¸ºä»€ä¹ˆéœ€è¦æ¢é’ˆ

çƒ˜ç„™å…‰ç…§åªå½±å“**é™æ€ç‰©ä½“**ã€‚é‚£åŠ¨æ€ç‰©ä½“ï¼ˆè§’è‰²ã€NPCã€å¯ç§»åŠ¨çš„é“å…·ï¼‰æ€ä¹ˆåŠï¼Ÿ

- **Light Probe**ï¼šä¸ºåŠ¨æ€ç‰©ä½“æä¾›**é—´æ¥å…‰ç…§**ä¿¡æ¯
- **Reflection Probe**ï¼šä¸ºç‰©ä½“æä¾›**ç¯å¢ƒåå°„**ä¿¡æ¯

```
æ¢é’ˆå·¥ä½œåŸç†ï¼š

Light Probeï¼ˆå…‰æ¢é’ˆï¼‰ï¼š
  åœ¨ç©ºé—´ä¸­æ”¾ç½®è‹¥å¹²æ¢æµ‹ç‚¹ï¼Œçƒ˜ç„™æ—¶è®°å½•æ¯ä¸ªç‚¹çš„å…‰ç…§ç¯å¢ƒ
  è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ç‰©ä½“æ ¹æ®ä½ç½®åœ¨æœ€è¿‘çš„æ¢æµ‹ç‚¹ä¹‹é—´æ’å€¼è·å–å…‰ç…§

  â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—      â† å…‰æ¢é’ˆç½‘æ ¼
  â”‚  â”‚  â”‚  â”‚  â”‚
  â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—
  â”‚  ğŸ§ â”‚  â”‚  â”‚      â† åŠ¨æ€è§’è‰²æ ¹æ®ä½ç½®åœ¨æ¢é’ˆä¹‹é—´æ’å€¼
  â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—

Reflection Probeï¼ˆåå°„æ¢é’ˆï¼‰ï¼š
  åœ¨æŒ‡å®šä½ç½®æ•è· 360Â° ç¯å¢ƒè´´å›¾ï¼ˆCubeMapï¼‰
  ç‰©ä½“ä½¿ç”¨æœ€è¿‘çš„åå°„æ¢é’ˆè·å–åå°„ä¿¡æ¯

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   ğŸ         â”‚
  â”‚       [RP]  â”‚      â† åå°„æ¢é’ˆåœ¨æˆ¿é—´ä¸­å¿ƒ
  â”‚         ğŸª  â”‚      â† é‡‘å±/å…‰æ»‘ç‰©ä½“ä¼šåå°„æ¢é’ˆæ•è·çš„ç¯å¢ƒ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.5.2 æ”¾ç½® Light Probe

1. Hierarchy â†’ å³é”® â†’ `Light` â†’ `Light Probe Group`
2. åœ¨ Scene è§†å›¾ä¸­é€‰ä¸­ Light Probe Group
3. åœ¨ Inspector ä¸­ç‚¹å‡» `Edit Light Probes` è¿›å…¥ç¼–è¾‘æ¨¡å¼
4. æ·»åŠ /åˆ é™¤/ç§»åŠ¨æ¢é’ˆç‚¹

[æˆªå›¾ï¼šåœºæ™¯ä¸­çš„ Light Probe Groupï¼Œæ˜¾ç¤ºé»„è‰²æ¢é’ˆç‚¹å’Œè¿çº¿]

**Light Probe æ”¾ç½®åŸåˆ™ï¼š**
```
å¥½çš„æ”¾ç½®ï¼š                    ä¸å¥½çš„æ”¾ç½®ï¼š
â—     â—     â—               â—â—â—â—â—â—â—â—â—â—â—â—
    â—     â—                  å¤ªå¤šå¤ªå¯†â€”â€”æµªè´¹
â—     â—     â—
åœ¨å…‰ç…§å˜åŒ–çš„åœ°æ–¹              â—           â—
å¯†åº¦æ›´é«˜                     å¤ªå°‘å¤ªç¨€â€”â€”æ— æ³•è¡¨è¾¾
                             å…‰ç…§å˜åŒ–
æ¨èï¼š
- é—¨å£ã€çª—æˆ·é™„è¿‘å¯†ä¸€äº›ï¼ˆå…‰ç…§å˜åŒ–å¤§ï¼‰
- èµ°å»Šã€è¿‡æ¸¡åŒºåŸŸå¯†ä¸€äº›
- å¼€é˜”ç©ºåœ°ç–ä¸€äº›
- è§’è‰²ä¸ä¼šåˆ°è¾¾çš„åœ°æ–¹ä¸æ”¾
```

### 11.5.3 æ”¾ç½® Reflection Probe

1. Hierarchy â†’ å³é”® â†’ `Light` â†’ `Reflection Probe`
2. è°ƒæ•´ Probe çš„ Box Size è¦†ç›–éœ€è¦çš„åŒºåŸŸ
3. è®¾ç½® Typeï¼ˆBaked æˆ– Realtimeï¼‰

[æˆªå›¾ï¼šReflection Probe çš„ Inspector é¢æ¿å’Œåœºæ™¯ä¸­çš„èŒƒå›´æ¡†]

```
Reflection Probe è®¾ç½®ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type: Baked                          â”‚  â† çƒ˜ç„™ï¼ˆæ¨èï¼‰æˆ– Realtime
â”‚                                      â”‚
â”‚ Runtime Settings:                    â”‚
â”‚   Importance: 1                      â”‚  â† ä¼˜å…ˆçº§ï¼ˆé‡å åŒºåŸŸå–é«˜ä¼˜å…ˆçº§ï¼‰
â”‚   Box Size: (10, 5, 10)             â”‚  â† å½±å“èŒƒå›´
â”‚   Box Offset: (0, 0, 0)             â”‚
â”‚   Box Projection: â˜‘                  â”‚  â† å®¤å†…ç¯å¢ƒæ¨èå¼€å¯
â”‚                                      â”‚
â”‚ Resolution: 128                      â”‚  â† åå°„è´´å›¾åˆ†è¾¨ç‡
â”‚                                      â”‚     æ‰‹æ¸¸ç”¨ 64-128
â”‚ HDR: â˜‘                               â”‚
â”‚ Shadow Distance: 0                   â”‚  â† åå°„ä¸­æ˜¯å¦åŒ…å«é˜´å½±
â”‚                                      â”‚
â”‚ Time Slicing: All Faces At Once      â”‚  â† å®æ—¶æ¢é’ˆçš„æ›´æ–°ç­–ç•¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ¯ **æœ€ä½³å®è·µ**ï¼š
> - å®¤å†…æ¯ä¸ªæˆ¿é—´æ”¾ä¸€ä¸ª Reflection Probe
> - å®¤å¤–åœ¨å…³é”®åŒºåŸŸï¼ˆæ°´é¢ã€é‡‘å±å»ºç­‘æ—ï¼‰æ”¾ç½®
> - æ‰‹æ¸¸ä½¿ç”¨ Baked æ¨¡å¼ï¼Œé¿å… Realtime çš„æ€§èƒ½å¼€é”€
> - åˆ†è¾¨ç‡ä¸è¦å¤ªé«˜ï¼Œ128 å¯¹æ‰‹æ¸¸è¶³å¤Ÿ

---

## 11.6 é˜´å½±ç³»ç»Ÿ

### 11.6.1 é˜´å½±çš„é‡è¦æ€§

é˜´å½±æ˜¯è®© 3D åœºæ™¯çœ‹èµ·æ¥"çœŸå®"æœ€é‡è¦çš„å› ç´ ä¹‹ä¸€â€”â€”æ²¡æœ‰é˜´å½±ï¼Œç‰©ä½“ä¼šåƒæµ®åœ¨ç©ºä¸­ä¸€æ ·ä¸è‡ªç„¶ã€‚

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šé˜´å½±åœ¨ 3D ä¸­çš„ä½œç”¨å°±åƒ CSS `box-shadow` åœ¨ UI è®¾è®¡ä¸­çš„ä½œç”¨â€”â€”æä¾›æ·±åº¦æ„Ÿå’Œç©ºé—´æ„Ÿã€‚Material Design æ•´å¥—è®¾è®¡è¯­è¨€å°±å»ºç«‹åœ¨ `elevation`ï¼ˆé˜´å½±ï¼‰ä¹‹ä¸Šã€‚

### 11.6.2 é˜´å½±é…ç½®

**åœ¨ URP Pipeline Asset ä¸­é…ç½®å…¨å±€é˜´å½±ï¼š**

```
Shadow Settingsï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ===== Shadows =====                   â”‚
â”‚                                      â”‚
â”‚ Main Light Shadow:                   â”‚
â”‚   Cast Shadows: â˜‘                    â”‚
â”‚   Shadow Resolution: 2048           â”‚  â† é˜´å½±è´´å›¾åˆ†è¾¨ç‡
â”‚                                      â”‚     æ‰‹æ¸¸æ¨è 1024-2048
â”‚                                      â”‚
â”‚ Max Distance: 50                     â”‚  â† é˜´å½±æ¸²æŸ“æœ€å¤§è·ç¦»ï¼ˆç±³ï¼‰
â”‚                                      â”‚     è¶…è¿‡æ­¤è·ç¦»çš„ç‰©ä½“æ— é˜´å½±
â”‚                                      â”‚     æ‰‹æ¸¸æ¨è 30-50
â”‚                                      â”‚
â”‚ Cascade Count: 2                     â”‚  â† çº§è”é˜´å½±å±‚æ•°
â”‚                                      â”‚     è¶Šå¤šè¶Šç»†è…»ï¼Œè¶Šè€—æ€§èƒ½
â”‚                                      â”‚     æ‰‹æ¸¸æ¨è 2
â”‚                                      â”‚
â”‚ Split 1: 0.25                        â”‚  â† ç¬¬ä¸€çº§å æ¯”
â”‚                                      â”‚
â”‚ Depth Bias: 1                        â”‚  â† æ·±åº¦åç§»ï¼ˆé˜²æ­¢è‡ªé˜´å½±ä¼ªå½±ï¼‰
â”‚ Normal Bias: 1                       â”‚  â† æ³•çº¿åç§»
â”‚                                      â”‚
â”‚ Soft Shadows: â˜‘                      â”‚  â† è½¯é˜´å½±ï¼ˆæ›´æŸ”å’Œçš„è¾¹ç¼˜ï¼‰
â”‚                                      â”‚     æ€§èƒ½å¼€é”€ç¨å¤§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.6.3 çº§è”é˜´å½±ï¼ˆShadow Cascadesï¼‰

```
çº§è”é˜´å½±åŸç†ï¼š

ä¸ä½¿ç”¨çº§è”ï¼ˆ1çº§ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ è¿‘å¤„ä¹Ÿç²—ç³™   è¿œå¤„ä¹Ÿç²—ç³™ â–“â–“â–“â–“   â”‚  â† æ•´ä¸ªè·ç¦»ç”¨åŒä¸€å¼ é˜´å½±è´´å›¾
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç›¸æœº                              æœ€å¤§è·ç¦»
  æ•ˆæœï¼šè¿‘å¤„é˜´å½±é”¯é½¿ä¸¥é‡

ä½¿ç”¨ 4 çº§çº§è”ï¼š
  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚ â–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â–“â–“â–“â–“      â”‚  â–‘â–‘â–‘â–‘    â”‚
  â”‚é«˜ç²¾åº¦â”‚ ä¸­ç²¾åº¦ â”‚  ä½ç²¾åº¦    â”‚  æœ€ä½    â”‚
  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç›¸æœº   è¿‘   â†â”€â†’  ä¸­  â†â”€â†’  è¿œ  â†â”€â†’  æœ€è¿œ
  æ•ˆæœï¼šè¿‘å¤„é˜´å½±æ¸…æ™°ï¼Œè¿œå¤„å…è®¸é™ä½è´¨é‡

æ‰‹æ¸¸æ¨è 2 çº§ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘          â”‚
  â”‚ è¿‘å¤„é«˜ç²¾åº¦â”‚  è¿œå¤„ä½ç²¾åº¦               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.6.4 ç‰©ä½“çš„é˜´å½±è®¾ç½®

æ¯ä¸ª Mesh Renderer éƒ½æœ‰ç‹¬ç«‹çš„é˜´å½±è®¾ç½®ï¼š

```
MeshRenderer â†’ Lighting éƒ¨åˆ†ï¼š

Cast Shadows:
  Off       â† ä¸æŠ•å°„é˜´å½±
  On        â† æŠ•å°„é˜´å½±ï¼ˆé»˜è®¤ï¼‰
  Two Sided â† åŒé¢æŠ•å°„ï¼ˆè–„ç‰‡çŠ¶ç‰©ä½“ç”¨ï¼‰
  Shadows Only â† åªæœ‰é˜´å½±ï¼Œç‰©ä½“ä¸å¯è§ï¼ˆç”¨äºé˜´å½±å ä½ï¼‰

Receive Shadows: â˜‘  â† æ˜¯å¦æ¥æ”¶å…¶ä»–ç‰©ä½“çš„é˜´å½±
```

[æˆªå›¾ï¼šMesh Renderer çš„ Cast Shadows å’Œ Receive Shadows è®¾ç½®]

---

## 11.7 åå¤„ç†æ•ˆæœï¼ˆPost-Processingï¼‰

### 11.7.1 ä»€ä¹ˆæ˜¯åå¤„ç†

åå¤„ç†æ˜¯åœ¨ 3D åœºæ™¯æ¸²æŸ“å®Œæˆåï¼Œå¯¹æœ€ç»ˆå›¾åƒåº”ç”¨çš„ä¸€ç³»åˆ—è§†è§‰æ•ˆæœâ€”â€”å°±åƒç…§ç‰‡æ‹å®Œåç”¨ Photoshop æˆ– Lightroom è°ƒè‰²ã€‚

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šåå¤„ç†å°±åƒ CSS çš„ `filter` å±æ€§ï¼ˆ`blur()`ã€`brightness()`ã€`contrast()`ã€`saturate()`ï¼‰åŠ ä¸Š `backdrop-filter`â€”â€”ä½†åŠŸèƒ½å¼ºå¤§å¾—å¤šã€‚

### 11.7.2 è®¾ç½® Post-Processing

**æ­¥éª¤ 1ï¼šåœ¨ Camera ä¸Šå¯ç”¨åå¤„ç†**
1. é€‰ä¸­ Main Camera
2. åœ¨ Camera ç»„ä»¶ä¸­å‹¾é€‰ `Post Processing`

[æˆªå›¾ï¼šCamera ç»„ä»¶ä¸­ Post Processing å¤é€‰æ¡†çš„ä½ç½®]

**æ­¥éª¤ 2ï¼šåˆ›å»º Post-Processing Volume**
1. Hierarchy â†’ å³é”® â†’ `Volume` â†’ `Global Volume`
2. åœ¨ Inspector ä¸­ç‚¹å‡» `New` åˆ›å»ºæ–°çš„ Volume Profile

[æˆªå›¾ï¼šGlobal Volume çš„ Inspector é¢æ¿]

**æ­¥éª¤ 3ï¼šæ·»åŠ æ•ˆæœ**
1. åœ¨ Volume Profile ä¸­ç‚¹å‡» `Add Override`
2. é€‰æ‹©éœ€è¦çš„æ•ˆæœ

### 11.7.3 å¸¸ç”¨åå¤„ç†æ•ˆæœ

#### Bloomï¼ˆè¾‰å…‰/æ³›å…‰ï¼‰

è®©é«˜äº®åŒºåŸŸäº§ç”Ÿå‘å…‰æ•ˆæœâ€”â€”è¥é€ æ¢¦å¹»ã€æ¸©æš–çš„æ°›å›´ã€‚

```
Bloom æ•ˆæœï¼š

å…³é—­ Bloomï¼š              å¼€å¯ Bloomï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      â—       â”‚          â”‚    âœ¨â—âœ¨      â”‚
â”‚   å¤ªé˜³       â”‚          â”‚  å¤ªé˜³å‘å…‰æ‰©æ•£  â”‚
â”‚              â”‚          â”‚              â”‚
â”‚   ğŸ®ç¯ç¬¼     â”‚          â”‚  ğŸ®âœ¨ç¯ç¬¼å‘å…‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

[æˆªå›¾ï¼šBloom æ•ˆæœçš„å¼€å…³å¯¹æ¯”]

```
Bloom è®¾ç½®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Threshold: 0.9                   â”‚  â† äº®åº¦é˜ˆå€¼ï¼ˆè¶…è¿‡æ­¤å€¼æ‰å‘å…‰ï¼‰
â”‚ Intensity: 1.0                   â”‚  â† å‘å…‰å¼ºåº¦
â”‚ Scatter: 0.7                     â”‚  â† æ‰©æ•£èŒƒå›´
â”‚ Clamp: 65472                     â”‚  â† æœ€å¤§äº®åº¦é™åˆ¶
â”‚ Tint: White                      â”‚  â† å‘å…‰é¢œè‰²è‰²è°ƒ
â”‚ High Quality Filtering: â˜‘        â”‚  â† é«˜è´¨é‡æ»¤æ³¢ï¼ˆæ‰‹æ¸¸å¯å…³ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Color Gradingï¼ˆé¢œè‰²åˆ†çº§/è°ƒè‰²ï¼‰

è°ƒæ•´æ•´ä½“ç”»é¢çš„é¢œè‰²é£æ ¼â€”â€”å°±åƒç»™æ¸¸æˆåŠ  Instagram æ»¤é•œã€‚

```
Color Grading è®¾ç½®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ===== White Balance =====        â”‚
â”‚ Temperature: 0                   â”‚  â† è‰²æ¸©ï¼ˆæ­£=æš–ï¼Œè´Ÿ=å†·ï¼‰
â”‚ Tint: 0                         â”‚  â† è‰²è°ƒï¼ˆæ­£=ç»¿ï¼Œè´Ÿ=å“çº¢ï¼‰
â”‚                                  â”‚
â”‚ ===== Tone Mapping =====         â”‚
â”‚ Mode: ACES                       â”‚  â† ACES ç”µå½±çº§è‰²è°ƒæ˜ å°„ï¼ˆæ¨èï¼‰
â”‚                                  â”‚
â”‚ ===== Lift Gamma Gain =====      â”‚
â”‚ Lift:  æš—éƒ¨é¢œè‰²è°ƒæ•´              â”‚
â”‚ Gamma: ä¸­é—´è°ƒé¢œè‰²è°ƒæ•´            â”‚
â”‚ Gain:  é«˜å…‰é¢œè‰²è°ƒæ•´              â”‚
â”‚                                  â”‚
â”‚ ===== Saturation =====           â”‚
â”‚ Post Exposure: 0                 â”‚  â† æ›å…‰è°ƒæ•´
â”‚ Contrast: 0                      â”‚  â† å¯¹æ¯”åº¦ (-100 ~ 100)
â”‚ Color Filter: White              â”‚  â† å…¨å±€é¢œè‰²æ»¤é•œ
â”‚ Saturation: 0                    â”‚  â† é¥±å’Œåº¦ (-100 ~ 100)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Vignetteï¼ˆæš—è§’ï¼‰

ç”»é¢è¾¹ç¼˜å˜æš—â€”â€”èšç„¦è§†è§‰ä¸­å¿ƒï¼Œè¥é€ ç”µå½±æ„Ÿã€‚

```
Vignette æ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚ â–‘â–‘â–‘          â–‘â–‘â–‘ â”‚
â”‚ â–‘â–‘    æ¸…æ™°    â–‘â–‘ â”‚
â”‚ â–‘â–‘   ä¸­å¿ƒåŒº   â–‘â–‘ â”‚
â”‚ â–‘â–‘â–‘          â–‘â–‘â–‘ â”‚
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   è¾¹ç¼˜é€æ¸å˜æš—

è®¾ç½®ï¼š
  Intensity: 0.3   â† æš—è§’å¼ºåº¦
  Smoothness: 0.3  â† è¿‡æ¸¡å¹³æ»‘åº¦
  Rounded: â˜‘       â† åœ†å½¢æš—è§’
```

#### Ambient Occlusionï¼ˆç¯å¢ƒå…‰é®è”½/AOï¼‰

è®©è§’è½å’Œæ¥ç¼å¤„å˜æš—â€”â€”å¢åŠ ç»†èŠ‚æ„Ÿå’Œæ·±åº¦æ„Ÿã€‚

```
Ambient Occlusion æ•ˆæœï¼š

å…³é—­ AOï¼š                å¼€å¯ AOï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚              â”‚        â”‚
â”‚  â”Œâ”€â”€â”  â”‚              â”‚  â”Œâ”€â”€â”  â”‚
â”‚  â”‚  â”‚  â”‚              â”‚â–’â–’â”‚  â”‚â–’â–’â”‚  â† è§’è½å¤„äº§ç”Ÿè‡ªç„¶çš„é˜´å½±
â”‚  â””â”€â”€â”˜  â”‚              â”‚â–’â–’â””â”€â”€â”˜â–’â–’â”‚
â”‚        â”‚              â”‚â–’â–’â–’â–’â–’â–’â–’â–’â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

URP ä¸­ä½¿ç”¨ SSAOï¼ˆScreen Space Ambient Occlusionï¼‰ï¼š
éœ€è¦åœ¨ URP Renderer Data ä¸­æ·»åŠ  SSAO Renderer Feature
```

**åœ¨ URP ä¸­å¯ç”¨ SSAOï¼š**
1. é€‰ä¸­ URP Renderer Data èµ„äº§
2. åœ¨ Inspector ä¸­ç‚¹å‡» `Add Renderer Feature`
3. é€‰æ‹© `Screen Space Ambient Occlusion`
4. é…ç½®å‚æ•°

[æˆªå›¾ï¼šURP Renderer Data ä¸­æ·»åŠ  SSAO Renderer Feature çš„æ“ä½œæ­¥éª¤]

```
SSAO è®¾ç½®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intensity: 1.0                   â”‚  â† AO å¼ºåº¦
â”‚ Radius: 0.035                    â”‚  â† é‡‡æ ·åŠå¾„
â”‚ Falloff Distance: 100            â”‚  â† è¡°å‡è·ç¦»
â”‚ Quality: Medium                  â”‚  â† é‡‡æ ·è´¨é‡
â”‚ Blur Quality: High               â”‚  â† æ¨¡ç³Šè´¨é‡
â”‚ After Opaque: â˜‘                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Depth of Fieldï¼ˆæ™¯æ·±ï¼‰

æ¨¡æ‹Ÿç›¸æœºå¯¹ç„¦æ•ˆæœâ€”â€”å‰æ™¯æˆ–èƒŒæ™¯æ¨¡ç³Šã€‚

```
Depth of Field æ•ˆæœï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–‘â–‘æ¨¡ç³Šâ–‘â–‘  æ¸…æ™°å¯¹ç„¦  â–‘â–‘æ¨¡ç³Šâ–‘â–‘ â”‚
â”‚ â–‘â–‘å‰æ™¯â–‘â–‘  â† ä¸»è§’ â†’  â–‘â–‘èƒŒæ™¯â–‘â–‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        è¿‘ç„¦è·    è¿œç„¦è·

DOF æ¨¡å¼ï¼š
  Gaussianï¼ˆé«˜æ–¯ï¼‰ï¼šç®€å•çš„æ¨¡ç³Šï¼Œæ€§èƒ½å¥½
  Bokehï¼ˆæ•£æ™¯ï¼‰ï¼šçœŸå®çš„å…‰åœˆæ•£æ™¯æ•ˆæœï¼Œæ€§èƒ½è¾ƒé‡

è®¾ç½®ï¼ˆGaussianï¼‰ï¼š
  Start: 10        â† å¼€å§‹æ¨¡ç³Šçš„è·ç¦»
  End: 30          â† å®Œå…¨æ¨¡ç³Šçš„è·ç¦»
```

### 11.7.4 å®Œæ•´åå¤„ç†è®¾ç½®ä»£ç 

```csharp
using UnityEngine;
using UnityEngine.Rendering;
using UnityEngine.Rendering.Universal;

/// <summary>
/// åå¤„ç†æ•ˆæœè¿è¡Œæ—¶æ§åˆ¶
///
/// ç±»æ¯”å‰ç«¯ï¼šç±»ä¼¼åŠ¨æ€ä¿®æ”¹ CSS filter å±æ€§
/// element.style.filter = `blur(${value}px) brightness(${value})`;
///
/// ç”¨é€”ï¼š
/// - è§’è‰²å—ä¼¤æ—¶ç”»é¢å˜çº¢
/// - è¿›å…¥æ°´ä¸‹æ—¶æ·»åŠ æ¨¡ç³Šå’Œè“è‰²è‰²è°ƒ
/// - Boss æˆ˜æ—¶å¢åŠ æš—è§’å’Œå¯¹æ¯”åº¦
/// </summary>
public class PostProcessingController : MonoBehaviour
{
    [SerializeField] private Volume globalVolume;

    // ç¼“å­˜å„æ•ˆæœå¼•ç”¨
    private Bloom bloom;
    private ColorAdjustments colorAdjustments;
    private Vignette vignette;
    private DepthOfField depthOfField;
    private ChromaticAberration chromaticAberration;

    void Start()
    {
        // è·å–å„åå¤„ç†æ•ˆæœçš„å¼•ç”¨
        VolumeProfile profile = globalVolume.profile;

        profile.TryGet(out bloom);
        profile.TryGet(out colorAdjustments);
        profile.TryGet(out vignette);
        profile.TryGet(out depthOfField);
        profile.TryGet(out chromaticAberration);
    }

    /// <summary>
    /// è§’è‰²å—ä¼¤æ—¶çš„è§†è§‰æ•ˆæœ
    /// ç”»é¢é—ªçº¢ + æš—è§’åŠ é‡ + è‰²å·®
    /// </summary>
    public void OnPlayerHit(float damage)
    {
        // æš—è§’åŠ é‡
        if (vignette != null)
        {
            vignette.intensity.value = 0.5f;
            vignette.color.value = Color.red;
        }

        // è‰²å·®æ•ˆæœï¼ˆç”»é¢è¾¹ç¼˜è‰²å½©åˆ†ç¦»ï¼‰
        if (chromaticAberration != null)
        {
            chromaticAberration.intensity.value = 0.5f;
        }

        // é™ä½é¥±å’Œåº¦
        if (colorAdjustments != null)
        {
            colorAdjustments.saturation.value = -30f;
        }

        // 0.3 ç§’åæ¢å¤
        StartCoroutine(ResetHitEffect(0.3f));
    }

    /// <summary>
    /// æ¢å¤å—å‡»æ•ˆæœ
    /// </summary>
    private System.Collections.IEnumerator ResetHitEffect(float duration)
    {
        float elapsed = 0f;
        while (elapsed < duration)
        {
            elapsed += Time.deltaTime;
            float t = elapsed / duration;

            if (vignette != null)
            {
                vignette.intensity.value = Mathf.Lerp(0.5f, 0.3f, t);
                vignette.color.value = Color.Lerp(Color.red, Color.black, t);
            }

            if (chromaticAberration != null)
            {
                chromaticAberration.intensity.value = Mathf.Lerp(0.5f, 0f, t);
            }

            if (colorAdjustments != null)
            {
                colorAdjustments.saturation.value = Mathf.Lerp(-30f, 0f, t);
            }

            yield return null;
        }
    }

    /// <summary>
    /// è¿›å…¥æ°´ä¸‹æ—¶çš„è§†è§‰æ•ˆæœ
    /// </summary>
    public void EnterUnderwater()
    {
        if (colorAdjustments != null)
        {
            // è“è‰²è‰²è°ƒ
            colorAdjustments.colorFilter.value = new Color(0.5f, 0.7f, 1f);
            colorAdjustments.contrast.value = -20f;
        }

        if (bloom != null)
        {
            // å¢åŠ è¾‰å…‰ï¼Œæ¨¡æ‹Ÿæ°´ä¸­å…‰çº¿æ•£å°„
            bloom.intensity.value = 2f;
            bloom.threshold.value = 0.5f;
        }

        if (vignette != null)
        {
            vignette.intensity.value = 0.4f;
        }
    }

    /// <summary>
    /// ç¦»å¼€æ°´ä¸‹ï¼Œæ¢å¤æ­£å¸¸
    /// </summary>
    public void ExitUnderwater()
    {
        if (colorAdjustments != null)
        {
            colorAdjustments.colorFilter.value = Color.white;
            colorAdjustments.contrast.value = 0f;
        }

        if (bloom != null)
        {
            bloom.intensity.value = 1f;
            bloom.threshold.value = 0.9f;
        }

        if (vignette != null)
        {
            vignette.intensity.value = 0.3f;
        }
    }

    /// <summary>
    /// æš‚åœæ¸¸æˆæ—¶çš„æ™¯æ·±æ¨¡ç³Šæ•ˆæœ
    /// æ¨¡æ‹Ÿå¯¹ç„¦åœ¨ UI èœå•ä¸Šï¼Œæ¸¸æˆç”»é¢æ¨¡ç³Š
    /// </summary>
    public void SetPauseBlur(bool paused)
    {
        if (depthOfField != null)
        {
            depthOfField.active = paused;
            if (paused)
            {
                depthOfField.mode.value = DepthOfFieldMode.Gaussian;
                depthOfField.gaussianStart.value = 0f;
                depthOfField.gaussianEnd.value = 5f;
            }
        }
    }
}
```

---

## 11.8 Shader Graph åŸºç¡€

### 11.8.1 ä»€ä¹ˆæ˜¯ Shader

Shaderï¼ˆç€è‰²å™¨ï¼‰æ˜¯è¿è¡Œåœ¨ GPU ä¸Šçš„ç¨‹åºï¼Œå†³å®šäº†æ¯ä¸ªåƒç´ çš„æœ€ç»ˆé¢œè‰²â€”â€”åŒ…æ‹¬å…‰ç…§è®¡ç®—ã€çº¹ç†é‡‡æ ·ã€ç‰¹æ®Šæ•ˆæœç­‰ã€‚

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šShader å°±åƒ CSSï¼Œä½†æ˜¯ç”¨æ¥æ§åˆ¶ 3D ç‰©ä½“çš„å¤–è§‚ã€‚å¦‚æœä½ ç”¨è¿‡ WebGL çš„ GLSLï¼ŒUnity çš„ Shader æ¦‚å¿µå®Œå…¨ç›¸åŒã€‚Shader Graph å°±æ˜¯ Shader çš„å¯è§†åŒ–ç¼–è¾‘å™¨â€”â€”ç±»ä¼¼ Figma å¯¹è®¾è®¡çš„é™ä½é—¨æ§›ã€‚

### 11.8.2 åˆ›å»º Shader Graph

1. Project çª—å£å³é”® â†’ `Create` â†’ `Shader Graph` â†’ `URP` â†’ `Lit Shader Graph`
2. å‘½åä¸º `EmissivePulse`ï¼ˆå‘å…‰è„‰å†²æ•ˆæœï¼‰
3. åŒå‡»æ‰“å¼€ Shader Graph ç¼–è¾‘å™¨

[æˆªå›¾ï¼šShader Graph ç¼–è¾‘å™¨çš„å®Œæ•´ç•Œé¢ï¼Œæ ‡æ³¨ä¸»è¦åŒºåŸŸâ€”â€”Graph Inspectorï¼ˆå·¦ï¼‰ã€Node ç¼–è¾‘åŒºï¼ˆä¸­ï¼‰ã€Master Stackï¼ˆå³ï¼‰]

### 11.8.3 Shader Graph èŠ‚ç‚¹ç±»å‹

```
Shader Graph å¸¸ç”¨èŠ‚ç‚¹åˆ†ç±»ï¼š

Inputï¼ˆè¾“å…¥ï¼‰ï¼š
  â”œâ”€â”€ Time           â† æ—¶é—´ï¼ˆç”¨äºåŠ¨ç”»ï¼‰
  â”œâ”€â”€ UV             â† çº¹ç†åæ ‡
  â”œâ”€â”€ Position       â† é¡¶ç‚¹ä½ç½®
  â”œâ”€â”€ Normal         â† æ³•çº¿æ–¹å‘
  â””â”€â”€ Property       â† è‡ªå®šä¹‰å±æ€§ï¼ˆåœ¨ Inspector ä¸­å¯è°ƒï¼‰

Mathï¼ˆæ•°å­¦ï¼‰ï¼š
  â”œâ”€â”€ Add / Subtract / Multiply / Divide
  â”œâ”€â”€ Lerp           â† çº¿æ€§æ’å€¼
  â”œâ”€â”€ Sine / Cosine  â† ä¸‰è§’å‡½æ•°
  â”œâ”€â”€ Clamp          â† é™åˆ¶èŒƒå›´
  â””â”€â”€ Remap          â† å€¼åŸŸæ˜ å°„

Textureï¼ˆçº¹ç†ï¼‰ï¼š
  â”œâ”€â”€ Sample Texture 2D  â† é‡‡æ · 2D çº¹ç†
  â”œâ”€â”€ Tiling And Offset  â† å¹³é“ºå’Œåç§»
  â””â”€â”€ Normal Unpack      â† è§£åŒ…æ³•çº¿è´´å›¾

Channelï¼ˆé€šé“ï¼‰ï¼š
  â”œâ”€â”€ Split            â† æ‹†åˆ† RGBA é€šé“
  â””â”€â”€ Combine          â† åˆå¹¶é€šé“

Artisticï¼ˆè‰ºæœ¯ï¼‰ï¼š
  â”œâ”€â”€ Blend            â† æ··åˆæ¨¡å¼
  â””â”€â”€ Contrast / Saturation
```

### 11.8.4 å®æˆ˜ï¼šåˆ›å»ºå‘å…‰è„‰å†² Shader

æ•ˆæœï¼šç‰©ä½“å‘¨æœŸæ€§åœ°å‘å…‰å’Œæš—ç­ï¼Œå¸¸ç”¨äºå¯æ‹¾å–çš„é“å…·ã€‚

```
Shader Graph èŠ‚ç‚¹è¿æ¥å›¾ï¼š

[Time] â”€â”€â†’ [Multiply Ã—2Ï€] â”€â”€â†’ [Sine] â”€â”€â†’ [Remap (âˆ’1,1)â†’(0,1)]
                                              â”‚
[Emission Color] â”€â”€â†’ [Multiply] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                   Fragment: Emission

[Base Color] â”€â”€â†’ Fragment: Base Color
[Normal Map] â”€â”€â†’ Fragment: Normal
[Metallic]   â”€â”€â†’ Fragment: Metallic
[Smoothness] â”€â”€â†’ Fragment: Smoothness
```

**æ­¥éª¤ï¼š**

1. åˆ›å»ºå±æ€§ï¼ˆPropertyï¼‰ï¼š
   - `BaseColor`ï¼ˆColorï¼‰ï¼šåŸºç¡€é¢œè‰²
   - `EmissionColor`ï¼ˆColorï¼ŒHDRï¼‰ï¼šå‘å…‰é¢œè‰²
   - `PulseSpeed`ï¼ˆFloatï¼Œé»˜è®¤ 2ï¼‰ï¼šè„‰å†²é€Ÿåº¦
   - `EmissionIntensity`ï¼ˆFloatï¼Œé»˜è®¤ 3ï¼‰ï¼šå‘å…‰å¼ºåº¦

2. æ­å»ºèŠ‚ç‚¹ç½‘ç»œï¼š
   - Time èŠ‚ç‚¹ â†’ Multiply (PulseSpeed) â†’ Sine â†’ Remap (-1,1 â†’ 0,1)
   - Remap è¾“å‡º â†’ Multiply (EmissionColor) â†’ Multiply (EmissionIntensity)
   - æœ€ç»ˆç»“æœè¿æ¥åˆ° Fragment çš„ Emission ç«¯å£

3. ä¿å­˜ Shader Graphï¼ˆCtrl+S / Cmd+Sï¼‰

[æˆªå›¾ï¼šå®Œæˆçš„ Shader Graph èŠ‚ç‚¹ç½‘ç»œ]

4. åˆ›å»ºæè´¨ï¼š
   - Project å³é”® â†’ Create â†’ Material
   - Shader é€‰æ‹©åˆšåˆ›å»ºçš„ `EmissivePulse`
   - åœ¨ Inspector ä¸­è°ƒæ•´å±æ€§

[æˆªå›¾ï¼šä½¿ç”¨ EmissivePulse æè´¨çš„é“å…·åœ¨ Scene ä¸­çš„å‘å…‰æ•ˆæœ]

---

## 11.9 æè´¨ä¸çº¹ç†ç³»ç»Ÿ

### 11.9.1 PBR æè´¨åŸºç¡€

URP é»˜è®¤ä½¿ç”¨ **PBRï¼ˆPhysically Based Renderingï¼‰** æè´¨ç³»ç»Ÿâ€”â€”åŸºäºç‰©ç†çš„æ¸²æŸ“ã€‚

```
PBR æè´¨é€šé“ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Materialï¼ˆæè´¨ï¼‰= å¤šå¼ çº¹ç†è´´å›¾çš„ç»„åˆ          â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Base Map (Albedo)             â”‚
â”‚ â”‚ ğŸ¨       â”‚  åŸºç¡€é¢œè‰²è´´å›¾                   â”‚
â”‚ â”‚ é¢œè‰²/çº¹ç† â”‚  å®šä¹‰ç‰©ä½“çš„é¢œè‰²å’Œå›¾æ¡ˆ            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ç±»æ¯”ï¼šCSS background-color     â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Normal Map (æ³•çº¿è´´å›¾)          â”‚
â”‚ â”‚ ğŸ—ºï¸       â”‚  è“ç´«è‰²çš„å‡¹å‡¸ä¿¡æ¯               â”‚
â”‚ â”‚ å‡¹å‡¸ç»†èŠ‚  â”‚  ä¸æ”¹å˜å‡ ä½•ä½“ï¼Œåªæ”¹å˜å…‰ç…§ç»†èŠ‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ç±»æ¯”ï¼šCSS çš„ box-shadow ç»†èŠ‚    â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Metallic Map (é‡‘å±åº¦)          â”‚
â”‚ â”‚ â¬›â¬œ     â”‚  é»‘ç™½è´´å›¾                        â”‚
â”‚ â”‚ é‡‘å±åº¦    â”‚  ç™½ = é‡‘å±ï¼ˆå¦‚é“ã€é‡‘ï¼‰            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  é»‘ = éé‡‘å±ï¼ˆå¦‚æœ¨å¤´ã€å¡‘æ–™ï¼‰      â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Smoothness (å…‰æ»‘åº¦)            â”‚
â”‚ â”‚ ğŸª       â”‚  è¡¨é¢å…‰æ»‘ç¨‹åº¦                    â”‚
â”‚ â”‚ å…‰æ»‘/ç²—ç³™ â”‚  1 = é•œé¢ï¼ˆç»ç’ƒï¼‰               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  0 = ç²—ç³™ï¼ˆçŸ³å¤´ï¼‰                â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Emission Map (è‡ªå‘å…‰)          â”‚
â”‚ â”‚ âœ¨       â”‚  è‡ªå‘å…‰åŒºåŸŸå’Œé¢œè‰²                â”‚
â”‚ â”‚ å‘å…‰      â”‚  ç”¨äºéœ“è™¹ç¯ã€å±å¹•ã€é­”æ³•æ•ˆæœ      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  é…åˆ Bloom åå¤„ç†æ•ˆæœ           â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Occlusion Map (AO è´´å›¾)       â”‚
â”‚ â”‚ ğŸŒ‘       â”‚  é¢„çƒ˜ç„™çš„ç¯å¢ƒå…‰é®è”½              â”‚
â”‚ â”‚ è§’è½é˜´å½±  â”‚  è§’è½å’Œç¼éš™å¤„å˜æš—                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  å¢åŠ ç»†èŠ‚çœŸå®æ„Ÿ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.9.2 URP Lit Shader å±æ€§

[æˆªå›¾ï¼šURP Lit æè´¨çš„å®Œæ•´ Inspector é¢æ¿ï¼Œæ ‡æ³¨å„ä¸ªè´´å›¾æ§½ä½]

```
URP/Lit Shader å®Œæ•´å±æ€§ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ===== Surface Options =====                   â”‚
â”‚                                              â”‚
â”‚ Surface Type: Opaque / Transparent           â”‚
â”‚ Render Face: Front / Back / Both             â”‚
â”‚ Alpha Clipping: â˜                            â”‚
â”‚                                              â”‚
â”‚ ===== Surface Inputs =====                    â”‚
â”‚                                              â”‚
â”‚ Base Map: [çº¹ç†] Ã— [é¢œè‰²]                    â”‚  â† Albedo
â”‚ Metallic Map: [çº¹ç†]                         â”‚  â† é‡‘å±åº¦
â”‚   Metallic: 0.0 â”â”â”â”â”â”â”â”â”â”â”â”â” 1.0           â”‚
â”‚   Smoothness: 0.0 â”â”â”â”â”â”â”â—â”â”â” 1.0           â”‚
â”‚                                              â”‚
â”‚ Normal Map: [çº¹ç†]                           â”‚  â† æ³•çº¿è´´å›¾
â”‚   Normal Strength: 1.0                       â”‚
â”‚                                              â”‚
â”‚ Occlusion Map: [çº¹ç†]                        â”‚  â† AO è´´å›¾
â”‚                                              â”‚
â”‚ Emission: â˜                                  â”‚
â”‚   Emission Map: [çº¹ç†] Ã— [HDR é¢œè‰²]         â”‚
â”‚   Emission Intensity: 1.0                    â”‚
â”‚                                              â”‚
â”‚ ===== Advanced =====                          â”‚
â”‚                                              â”‚
â”‚ Specular Highlights: â˜‘                       â”‚
â”‚ Environment Reflections: â˜‘                   â”‚
â”‚ Receive Shadows: â˜‘                           â”‚
â”‚ GPU Instancing: â˜‘                            â”‚  â† å¼€å¯ GPU å®ä¾‹åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.9.3 çº¹ç†å¯¼å…¥è®¾ç½®

```
çº¹ç†å¯¼å…¥è®¾ç½®æ¨èï¼ˆæ‰‹æ¸¸ï¼‰ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Texture Type:                        â”‚
â”‚   Default        â† æ™®é€šè´´å›¾         â”‚
â”‚   Normal map     â† æ³•çº¿è´´å›¾         â”‚
â”‚   Sprite (2D)    â† 2D/UI ç”¨        â”‚
â”‚                                      â”‚
â”‚ Max Size: 1024                       â”‚  â† æ‰‹æ¸¸æ¨èæœ€å¤§ 1024-2048
â”‚                                      â”‚
â”‚ Compression:                         â”‚
â”‚   ASTC 6x6      â† iOS/Android æ¨è â”‚
â”‚                                      â”‚
â”‚ Generate Mip Maps: â˜‘                 â”‚  â† è¿œå¤„ä½¿ç”¨ä½ç²¾åº¦çº¹ç†
â”‚                                      â”‚     æå‡æ€§èƒ½å’Œå‡å°‘æ‘©å°”çº¹
â”‚                                      â”‚
â”‚ sRGB (Color Texture): â˜‘              â”‚  â† é¢œè‰²è´´å›¾å¼€å¯
â”‚                                      â”‚     æ³•çº¿è´´å›¾å…³é—­
â”‚                                      â”‚
â”‚ Filter Mode: Bilinear               â”‚  â† è¿‡æ»¤æ¨¡å¼
â”‚ Aniso Level: 1                       â”‚  â† å„å‘å¼‚æ€§è¿‡æ»¤çº§åˆ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.9.4 æè´¨è®¾ç½®ä»£ç 

```csharp
using UnityEngine;

/// <summary>
/// è¿è¡Œæ—¶æè´¨å±æ€§æ§åˆ¶
/// ç±»æ¯”å‰ç«¯ï¼šelement.style.backgroundColor = 'red';
///
/// æ³¨æ„ï¼šç›´æ¥ä¿®æ”¹ renderer.material ä¼šåˆ›å»ºæè´¨å®ä¾‹ï¼ˆå¢åŠ å†…å­˜ï¼‰
/// å¦‚æœå¤šä¸ªç‰©ä½“å…±ç”¨ä¸€ä¸ªæè´¨ï¼Œåº”è¯¥ä½¿ç”¨ MaterialPropertyBlock
/// </summary>
public class MaterialController : MonoBehaviour
{
    private Renderer meshRenderer;
    private MaterialPropertyBlock propertyBlock;

    // Shader å±æ€§ IDï¼ˆé¢„è®¡ç®—ï¼Œç±»ä¼¼ Animator å‚æ•°å“ˆå¸Œï¼‰
    private static readonly int BaseColorId = Shader.PropertyToID("_BaseColor");
    private static readonly int EmissionColorId = Shader.PropertyToID("_EmissionColor");
    private static readonly int SmoothnessId = Shader.PropertyToID("_Smoothness");
    private static readonly int MetallicId = Shader.PropertyToID("_Metallic");

    void Start()
    {
        meshRenderer = GetComponent<Renderer>();
        propertyBlock = new MaterialPropertyBlock();
    }

    /// <summary>
    /// ä½¿ç”¨ MaterialPropertyBlock ä¿®æ”¹æè´¨å±æ€§ï¼ˆæ¨èæ–¹å¼ï¼‰
    /// ä¸ä¼šåˆ›å»ºæè´¨å®ä¾‹ï¼Œæ€§èƒ½æ›´å¥½
    /// </summary>
    public void SetColor(Color color)
    {
        meshRenderer.GetPropertyBlock(propertyBlock);
        propertyBlock.SetColor(BaseColorId, color);
        meshRenderer.SetPropertyBlock(propertyBlock);
    }

    /// <summary>
    /// è®¾ç½®å‘å…‰é¢œè‰²å’Œå¼ºåº¦
    /// </summary>
    public void SetEmission(Color color, float intensity)
    {
        meshRenderer.GetPropertyBlock(propertyBlock);
        // HDR é¢œè‰² = é¢œè‰² Ã— å¼ºåº¦ï¼ˆè¶…è¿‡ 1 çš„å€¼ä¼šè§¦å‘ Bloomï¼‰
        Color hdrColor = color * intensity;
        propertyBlock.SetColor(EmissionColorId, hdrColor);
        meshRenderer.SetPropertyBlock(propertyBlock);
    }

    /// <summary>
    /// è®¾ç½®é‡‘å±åº¦å’Œå…‰æ»‘åº¦
    /// </summary>
    public void SetMetallic(float metallic, float smoothness)
    {
        meshRenderer.GetPropertyBlock(propertyBlock);
        propertyBlock.SetFloat(MetallicId, metallic);
        propertyBlock.SetFloat(SmoothnessId, smoothness);
        meshRenderer.SetPropertyBlock(propertyBlock);
    }

    /// <summary>
    /// è§’è‰²å—ä¼¤æ—¶é—ªç™½æ•ˆæœ
    /// </summary>
    public void FlashWhite(float duration = 0.1f)
    {
        StartCoroutine(FlashCoroutine(duration));
    }

    private System.Collections.IEnumerator FlashCoroutine(float duration)
    {
        SetColor(Color.white);
        yield return new WaitForSeconds(duration);
        SetColor(Color.white); // æ¢å¤åŸè‰²ï¼ˆæ ¹æ®å®é™…é¡¹ç›®è°ƒæ•´ï¼‰
    }
}
```

---

## 11.10 URP Renderer Features

### 11.10.1 ä»€ä¹ˆæ˜¯ Renderer Feature

Renderer Features å…è®¸ä½ åœ¨ URP æ¸²æŸ“æµç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰çš„æ¸²æŸ“æ­¥éª¤â€”â€”ç›¸å½“äºåœ¨æ¸²æŸ“ç®¡çº¿ä¸­å®‰è£…"æ’ä»¶"ã€‚

> ğŸ’¡ **å‰ç«¯ç±»æ¯”**ï¼šRenderer Features ç±»ä¼¼ Webpack çš„ Pluginâ€”â€”åœ¨æ„å»ºï¼ˆæ¸²æŸ“ï¼‰æµç¨‹çš„ç‰¹å®šé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

### 11.10.2 æ·»åŠ  Renderer Feature

1. é€‰ä¸­ URP Renderer Data èµ„äº§ï¼ˆ`URP-Pipeline_Renderer.asset`ï¼‰
2. Inspector åº•éƒ¨ç‚¹å‡» `Add Renderer Feature`
3. é€‰æ‹©éœ€è¦çš„ Feature

[æˆªå›¾ï¼šAdd Renderer Feature çš„ä¸‹æ‹‰èœå•ï¼Œæ˜¾ç¤ºå¯ç”¨çš„ Feature åˆ—è¡¨]

**å†…ç½® Renderer Featuresï¼š**

| Feature | ç”¨é€” |
|---------|------|
| Screen Space Ambient Occlusion | SSAO ç¯å¢ƒå…‰é®è”½ |
| Decal | è´´èŠ±ï¼ˆå¼¹å­”ã€æ±¡æ¸ç­‰ï¼‰ |
| Render Objects | åœ¨ç‰¹å®šé˜¶æ®µæ¸²æŸ“ç‰¹å®š Layer çš„ç‰©ä½“ |
| Full Screen Pass | å…¨å±åå¤„ç†æ•ˆæœ |

### 11.10.3 ä½¿ç”¨ Render Objects å®ç°è§’è‰²æè¾¹

ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼šåœ¨è§’è‰²å‘¨å›´æ·»åŠ æè¾¹æ•ˆæœï¼ˆå¡é€šé£æ ¼ï¼‰ã€‚

**æ­¥éª¤ï¼š**
1. åˆ›å»ºæè¾¹æè´¨ï¼š
   - æ–°å»ºæè´¨ï¼Œä½¿ç”¨ `Unlit` Shader
   - è®¾ç½®é¢œè‰²ä¸ºé»‘è‰²æˆ–ä½ éœ€è¦çš„æè¾¹é¢œè‰²
2. åœ¨ Renderer Data ä¸­æ·»åŠ  `Render Objects` Feature
3. é…ç½®ï¼š
   - Event: `BeforeRenderingOpaques`
   - Layer Mask: é€‰æ‹©è§’è‰²æ‰€åœ¨çš„ Layer
   - Override Material: æè¾¹æè´¨
   - Override â†’ Depth: Write = On, Test = Less Equal

[æˆªå›¾ï¼šRender Objects Feature é…ç½®æè¾¹æ•ˆæœçš„å‚æ•°]

---

## 11.11 Camera Stackingï¼ˆç›¸æœºå †å ï¼‰

### 11.11.1 ä¸ºä»€ä¹ˆéœ€è¦ç›¸æœºå †å 

æœ‰æ—¶å€™ä½ éœ€è¦ç”¨ä¸åŒçš„è®¾ç½®æ¸²æŸ“ä¸åŒçš„å†…å®¹å±‚ã€‚

```
ç›¸æœºå †å çš„å…¸å‹åœºæ™¯ï¼š

Base Cameraï¼ˆåŸºç¡€ç›¸æœºï¼‰ï¼š
  æ¸²æŸ“ 3D æ¸¸æˆä¸–ç•Œ

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ”ï¸ å¤©ç©º               â”‚
  â”‚    ğŸŒ³ğŸ ğŸŒ³              â”‚
  â”‚      ğŸ§                â”‚
  â”‚  ğŸŒ¿ğŸŒ¿ğŸŒ¿ğŸŒ¿              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ å åŠ 
Overlay Cameraï¼ˆè¦†ç›–ç›¸æœºï¼‰ï¼š
  æ¸²æŸ“ UI æˆ–ç‰¹æ®Šæ•ˆæœ

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ [HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]    12:30 â”‚
  â”‚                        â”‚
  â”‚                        â”‚
  â”‚              [å°åœ°å›¾]   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ å åŠ 
Overlay Camera 2ï¼š
  æ¸²æŸ“æ­¦å™¨æ¨¡å‹ï¼ˆç‹¬ç«‹ FOVï¼‰

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                        â”‚
  â”‚                        â”‚
  â”‚                  ğŸ”«    â”‚
  â”‚                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.11.2 è®¾ç½® Camera Stacking

**æ­¥éª¤ 1ï¼šè®¾ç½® Base Camera**
1. é€‰ä¸­ Main Camera
2. Render Type è®¾ä¸º `Base`
3. åœ¨ `Stack` åˆ—è¡¨ä¸­æ·»åŠ  Overlay Camera

**æ­¥éª¤ 2ï¼šåˆ›å»º Overlay Camera**
1. åˆ›å»ºæ–° Camera
2. Render Type è®¾ä¸º `Overlay`
3. è®¾ç½®åªæ¸²æŸ“éœ€è¦çš„ Layer
4. Clear Flags è®¾ä¸º `Don't Clear`ï¼ˆä¸æ¸…é™¤èƒŒæ™¯ï¼Œé€æ˜å åŠ ï¼‰

[æˆªå›¾ï¼šBase Camera çš„ Stack åˆ—è¡¨ä¸­æ·»åŠ äº† Overlay Camera]

```csharp
using UnityEngine;
using UnityEngine.Rendering.Universal;

/// <summary>
/// è¿è¡Œæ—¶æ§åˆ¶ Camera Stack
/// </summary>
public class CameraStackController : MonoBehaviour
{
    [SerializeField] private Camera baseCamera;
    [SerializeField] private Camera uiOverlayCamera;
    [SerializeField] private Camera weaponOverlayCamera;

    void Start()
    {
        // è·å– Base Camera çš„ URP æ•°æ®
        var cameraData = baseCamera.GetUniversalAdditionalCameraData();

        // æ·»åŠ  Overlay Camera åˆ° Stack
        cameraData.cameraStack.Add(uiOverlayCamera);
        cameraData.cameraStack.Add(weaponOverlayCamera);
    }

    /// <summary>
    /// è¿›å…¥èœå•æ—¶ç¦ç”¨æ­¦å™¨ç›¸æœº
    /// </summary>
    public void EnterMenu()
    {
        weaponOverlayCamera.gameObject.SetActive(false);
    }

    /// <summary>
    /// é€€å‡ºèœå•æ—¶å¯ç”¨æ­¦å™¨ç›¸æœº
    /// </summary>
    public void ExitMenu()
    {
        weaponOverlayCamera.gameObject.SetActive(true);
    }
}
```

---

## 11.12 å®æˆ˜ï¼šå®Œæ•´çš„åœºæ™¯å…‰ç…§è®¾ç½®

### 11.12.1 åœºæ™¯å…‰ç…§é…ç½®æ­¥éª¤

ä»¥ä¸€ä¸ªæˆ·å¤–å¼€æ”¾ä¸–ç•Œåœºæ™¯ä¸ºä¾‹ï¼Œå®Œæ•´çš„å…‰ç…§è®¾ç½®æµç¨‹ï¼š

```
æ­¥éª¤æ¸…å•ï¼š

1. â˜ ç¯å¢ƒå…‰ç…§è®¾ç½®
   Project Settings â†’ Lighting â†’ Environment
   - Skybox Material: é€‰æ‹©å¤©ç©ºç›’
   - Environment Lighting Source: Skybox
   - Ambient Intensity: 1

2. â˜ ä¸»æ–¹å‘å…‰ï¼ˆå¤ªé˜³ï¼‰
   - Color: æš–ç™½è‰² #FFF5E0
   - Intensity: 1.5
   - Shadow Type: Soft Shadows
   - Mode: Mixed (éœ€è¦çƒ˜ç„™é—´æ¥å…‰ + å®æ—¶é˜´å½±)

3. â˜ è¡¥å…‰ï¼ˆFill Lightï¼Œå¯é€‰ï¼‰
   - ç¬¬äºŒä¸ª Directional Lightï¼Œå¼±å¼ºåº¦
   - æ–¹å‘ä¸å¤ªé˜³ç›¸åï¼ˆå‡å°‘çº¯é»‘é˜´å½±ï¼‰
   - ä¸æŠ•å°„é˜´å½±
   - Intensity: 0.2

4. â˜ æ ‡è®°é™æ€ç‰©ä½“
   - é€‰ä¸­æ‰€æœ‰ä¸ä¼šç§»åŠ¨çš„ç‰©ä½“
   - å‹¾é€‰ Static â†’ Contribute GI

5. â˜ æ”¾ç½® Light Probes
   - åœ¨è§’è‰²æ´»åŠ¨åŒºåŸŸæ”¾ç½®
   - å…‰ç…§å˜åŒ–å¤§çš„åœ°æ–¹å¯†é›†æ’åˆ—

6. â˜ æ”¾ç½® Reflection Probes
   - æ°´é¢é™„è¿‘
   - å®¤å†…ç¯å¢ƒ
   - é‡‘å±/å…‰æ»‘å»ºç­‘ç‰©æ—

7. â˜ çƒ˜ç„™å…‰ç…§
   - Lightmapper: Progressive GPU
   - Resolution: 20ï¼ˆå¼€å‘é˜¶æ®µç”¨ 10ï¼‰
   - Bounces: 2
   - ç‚¹å‡» Generate Lighting

8. â˜ åå¤„ç†è®¾ç½®
   - åˆ›å»º Global Volume
   - æ·»åŠ  Bloomã€Color Gradingã€Vignette
   - è°ƒæ•´å‚æ•°è‡³æ»¡æ„

9. â˜ æ€§èƒ½æ£€æŸ¥
   - æŸ¥çœ‹ Stats çª—å£çš„ Draw Calls
   - åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæµ‹è¯•å¸§ç‡
```

### 11.12.2 ç¯å¢ƒè®¾ç½®ä»£ç 

```csharp
using UnityEngine;
using UnityEngine.Rendering;
using UnityEngine.Rendering.Universal;

/// <summary>
/// ç¯å¢ƒå…‰ç…§å’Œæ°›å›´æ§åˆ¶å™¨
/// ç®¡ç†å¤©ç©ºç›’ã€é›¾æ•ˆã€ç¯å¢ƒå…‰ç­‰
/// </summary>
public class EnvironmentController : MonoBehaviour
{
    [Header("å¤©ç©ºç›’")]
    [SerializeField] private Material daySkybox;
    [SerializeField] private Material nightSkybox;

    [Header("é›¾æ•ˆ")]
    [SerializeField] private Color dayFogColor = new Color(0.7f, 0.8f, 0.9f);
    [SerializeField] private Color nightFogColor = new Color(0.05f, 0.05f, 0.15f);
    [SerializeField] private float fogDensity = 0.01f;

    [Header("ç¯å¢ƒå…‰")]
    [SerializeField] private Color dayAmbientColor = new Color(0.5f, 0.5f, 0.6f);
    [SerializeField] private Color nightAmbientColor = new Color(0.05f, 0.05f, 0.1f);

    /// <summary>
    /// æ ¹æ®æ—¶é—´æ›´æ–°ç¯å¢ƒ
    /// </summary>
    /// <param name="dayNightRatio">æ˜¼å¤œæ¯”ä¾‹ 0=å¤œæ™š 1=ç™½å¤©</param>
    public void UpdateEnvironment(float dayNightRatio)
    {
        float t = Mathf.Clamp01(dayNightRatio);

        // æ›´æ–°é›¾æ•ˆ
        RenderSettings.fogColor = Color.Lerp(nightFogColor, dayFogColor, t);
        RenderSettings.fogDensity = fogDensity;
        RenderSettings.fog = true;

        // æ›´æ–°ç¯å¢ƒå…‰
        RenderSettings.ambientLight = Color.Lerp(
            nightAmbientColor, dayAmbientColor, t);

        // å¤©ç©ºç›’è¿‡æ¸¡ï¼ˆä½¿ç”¨æè´¨æ··åˆæˆ–åˆ‡æ¢ï¼‰
        if (t > 0.5f)
        {
            RenderSettings.skybox = daySkybox;
        }
        else
        {
            RenderSettings.skybox = nightSkybox;
        }
    }

    /// <summary>
    /// è®¾ç½®é›¾æ•ˆå‚æ•°
    /// </summary>
    public void SetFog(bool enabled, Color color, float density)
    {
        RenderSettings.fog = enabled;
        RenderSettings.fogColor = color;
        RenderSettings.fogMode = FogMode.Exponential;
        RenderSettings.fogDensity = density;
    }
}
```

---

## 11.13 æœ¬ç« å°ç»“

```
URP å…‰ç…§ä¸æ¸²æŸ“çŸ¥è¯†å›¾è°±ï¼š

URP æ¸²æŸ“ç®¡çº¿
â”œâ”€â”€ Pipeline Asset é…ç½®
â”‚   â”œâ”€â”€ æ¸²æŸ“è´¨é‡ï¼ˆMSAAã€Render Scaleï¼‰
â”‚   â”œâ”€â”€ å…‰ç…§è®¾ç½®ï¼ˆPer Pixel / Per Vertexï¼‰
â”‚   â”œâ”€â”€ é˜´å½±è®¾ç½®ï¼ˆè·ç¦»ã€çº§è”ã€åˆ†è¾¨ç‡ï¼‰
â”‚   â””â”€â”€ å¤šä¸ªç”»è´¨ Presetï¼ˆLow/Medium/Highï¼‰
â”‚
â”œâ”€â”€ å…‰æºç³»ç»Ÿ
â”‚   â”œâ”€â”€ Directional Lightï¼ˆå¤ªé˜³ï¼‰
â”‚   â”œâ”€â”€ Point Lightï¼ˆç¯æ³¡ï¼‰
â”‚   â”œâ”€â”€ Spot Lightï¼ˆæ‰‹ç”µç­’ï¼‰
â”‚   â”œâ”€â”€ Area Lightï¼ˆçª—æˆ·ï¼Œä»…çƒ˜ç„™ï¼‰
â”‚   â””â”€â”€ å…‰æºæ¨¡å¼ï¼ˆRealtime / Mixed / Bakedï¼‰
â”‚
â”œâ”€â”€ å…‰ç…§çƒ˜ç„™
â”‚   â”œâ”€â”€ Lightmapï¼ˆå…‰ç…§è´´å›¾ï¼‰
â”‚   â”œâ”€â”€ Light Probeï¼ˆåŠ¨æ€ç‰©ä½“é—´æ¥å…‰ç…§ï¼‰
â”‚   â”œâ”€â”€ Reflection Probeï¼ˆç¯å¢ƒåå°„ï¼‰
â”‚   â””â”€â”€ Static æ ‡è®°
â”‚
â”œâ”€â”€ é˜´å½±ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Shadow Resolution
â”‚   â”œâ”€â”€ Shadow Distance
â”‚   â”œâ”€â”€ Shadow Cascades
â”‚   â””â”€â”€ Per-Object Shadow Settings
â”‚
â”œâ”€â”€ åå¤„ç†ï¼ˆPost-Processingï¼‰
â”‚   â”œâ”€â”€ Bloomï¼ˆè¾‰å…‰ï¼‰
â”‚   â”œâ”€â”€ Color Gradingï¼ˆè°ƒè‰²ï¼‰
â”‚   â”œâ”€â”€ Vignetteï¼ˆæš—è§’ï¼‰
â”‚   â”œâ”€â”€ SSAOï¼ˆç¯å¢ƒå…‰é®è”½ï¼‰
â”‚   â”œâ”€â”€ Depth of Fieldï¼ˆæ™¯æ·±ï¼‰
â”‚   â””â”€â”€ è¿è¡Œæ—¶åŠ¨æ€æ§åˆ¶
â”‚
â”œâ”€â”€ æè´¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ PBR è´´å›¾ï¼ˆAlbedo / Normal / Metallic / Emissionï¼‰
â”‚   â”œâ”€â”€ URP/Lit Shader
â”‚   â”œâ”€â”€ MaterialPropertyBlockï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
â”‚   â””â”€â”€ Shader Graphï¼ˆå¯è§†åŒ– Shader ç¼–è¾‘å™¨ï¼‰
â”‚
â”œâ”€â”€ Renderer Features
â”‚   â”œâ”€â”€ SSAO
â”‚   â”œâ”€â”€ Decal
â”‚   â””â”€â”€ Render Objectsï¼ˆè‡ªå®šä¹‰æ¸²æŸ“ï¼‰
â”‚
â””â”€â”€ Camera Stacking
    â”œâ”€â”€ Base Cameraï¼ˆåŸºç¡€æ¸²æŸ“ï¼‰
    â””â”€â”€ Overlay Cameraï¼ˆUIã€æ­¦å™¨ç­‰è¦†ç›–å±‚ï¼‰
```

**å…³é”®è¦ç‚¹å›é¡¾ï¼š**

1. **æ‰‹æ¸¸ç”¨ URP**â€”â€”æ€§èƒ½å’Œç”»è´¨çš„æœ€ä½³å¹³è¡¡
2. **å¤§é‡ä½¿ç”¨çƒ˜ç„™å…‰ç…§**â€”â€”æ‰‹æ¸¸çš„é—´æ¥å…‰ç…§å¿…é¡»é¢„è®¡ç®—
3. **Light Probe æ˜¯åŠ¨æ€ç‰©ä½“çš„ç”Ÿå‘½çº¿**â€”â€”æ²¡æœ‰å®ƒè§’è‰²ä¼š"ä¸ç¯å¢ƒè„±èŠ‚"
4. **åå¤„ç†æ˜¯ç‚¹ç›ä¹‹ç¬”**â€”â€”Bloom + Color Grading + Vignette ä¸‰ä»¶å¥—å¤§å¹…æå‡ç”»é¢è´¨æ„Ÿ
5. **MaterialPropertyBlock**â€”â€”ä¿®æ”¹æè´¨å±æ€§çš„æ­£ç¡®æ–¹å¼ï¼ˆè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ materialï¼‰
6. **åˆ›å»ºå¤šä¸ªç”»è´¨é¢„è®¾**â€”â€”è®©ç©å®¶å¯ä»¥æ ¹æ®è®¾å¤‡æ€§èƒ½é€‰æ‹©

---

## ç»ƒä¹ é¢˜

### ç»ƒä¹  1ï¼šå®¤å†…å…‰ç…§ï¼ˆéš¾åº¦ï¼šâ­â­ï¼‰
åˆ›å»ºä¸€ä¸ªç®€å•çš„å®¤å†…åœºæ™¯ï¼ˆç”¨ Cube æ­å»ºæˆ¿é—´ï¼‰ï¼š
- ä¸€ä¸ªæ–¹å‘å…‰ä½œä¸ºçª—æˆ·é€å…¥çš„å…‰çº¿
- ä¸¤ä¸ª Point Light ä½œä¸ºå®¤å†…ç¯ï¼ˆæš–è‰²è°ƒï¼‰
- çƒ˜ç„™å…‰ç…§ï¼ˆæ ‡è®°æ‰€æœ‰å¢™å£å’Œåœ°æ¿ä¸º Staticï¼‰
- æ”¾ç½® Light Probes å’Œ Reflection Probe
- è§‚å¯Ÿè§’è‰²åœ¨å®¤å†…çš„é—´æ¥å…‰ç…§æ•ˆæœ

### ç»ƒä¹  2ï¼šæ˜¼å¤œå¾ªç¯ï¼ˆéš¾åº¦ï¼šâ­â­â­ï¼‰
å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ˜¼å¤œå¾ªç¯ç³»ç»Ÿï¼š
- å¤ªé˜³ï¼ˆDirectional Lightï¼‰ç»• X è½´æ—‹è½¬ï¼Œæ¨¡æ‹Ÿæ—¥å‡æ—¥è½
- æ ¹æ®æ—¶é—´åŠ¨æ€è°ƒæ•´å¤ªé˜³é¢œè‰²å’Œå¼ºåº¦
- ç¯å¢ƒå…‰å’Œé›¾æ•ˆéšæ—¶é—´å˜åŒ–
- æ·»åŠ ä¸€ä¸ªç®€å•çš„ UI æ˜¾ç¤ºå½“å‰æ—¶é—´
- æç¤ºï¼šå‚è€ƒ 11.3.4 èŠ‚çš„ DynamicLightController

### ç»ƒä¹  3ï¼šåå¤„ç†æ•ˆæœåˆ‡æ¢ï¼ˆéš¾åº¦ï¼šâ­â­ï¼‰
åˆ›å»ºä¸‰ç§è§†è§‰é£æ ¼ï¼Œé€šè¿‡æŒ‰é”®åˆ‡æ¢ï¼š
- **æ ‡å‡†æ¨¡å¼**ï¼šBloom + è½»å¾®æš—è§’
- **å¤œè§†æ¨¡å¼**ï¼šç»¿è‰²è‰²è°ƒ + é«˜äº®åº¦ + å™ªç‚¹
- **å—ä¼¤æ¨¡å¼**ï¼šçº¢è‰²æš—è§’ + ä½é¥±å’Œåº¦ + è‰²å·®
  æç¤ºï¼šå¯ä»¥åˆ›å»ºå¤šä¸ª Volume Profile æˆ–åœ¨ä»£ç ä¸­åŠ¨æ€ä¿®æ”¹å‚æ•°ã€‚

### ç»ƒä¹  4ï¼šShader Graph ç»ƒä¹ ï¼ˆéš¾åº¦ï¼šâ­â­â­ï¼‰
ä½¿ç”¨ Shader Graph åˆ›å»ºä»¥ä¸‹æ•ˆæœä¹‹ä¸€ï¼š
- æ°´é¢ Shaderï¼šé€æ˜ + UV æµåŠ¨ + æ³•çº¿æ‰°åŠ¨
- æº¶è§£ Shaderï¼šä»ä¸‹åˆ°ä¸Šé€æ¸æ¶ˆèï¼ˆä½¿ç”¨å™ªå£°çº¹ç† + Clipï¼‰
- å…¨æ¯æŠ•å½± Shaderï¼šåŠé€æ˜ + æ‰«æçº¿ + è¾¹ç¼˜å‘å…‰
  æç¤ºï¼šå–„ç”¨ Time èŠ‚ç‚¹åˆ¶ä½œåŠ¨ç”»æ•ˆæœã€‚

---

## ä¸‹ä¸€ç« é¢„å‘Š

**ç¬¬ 12 ç« ï¼šèƒŒåŒ…ä¸ç‰©å“ç³»ç»Ÿ** å°†å­¦ä¹ ï¼š
- ScriptableObject æ•°æ®é©±åŠ¨è®¾è®¡
- èƒŒåŒ…æ•°æ®ç»“æ„ï¼ˆç‰©å“æ•°æ®åº“ã€å †å ã€æ’åºï¼‰
- ç‰©å“æ‹¾å–ä¸ä¸¢å¼ƒ
- èƒŒåŒ… UIï¼ˆGrid Layout + æ‹–æ‹½äº¤äº’ï¼‰
- è£…å¤‡ç³»ç»ŸåŸºç¡€
- å¼€å§‹æ„å»ºçœŸæ­£çš„æ¸¸æˆç©æ³•ç³»ç»Ÿï¼

---

> **ç‰ˆæƒå£°æ˜**ï¼šæœ¬æ•™ç¨‹ä¸º BellLab åŸåˆ›å†…å®¹ï¼Œä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚
