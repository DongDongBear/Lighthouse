# ç¬¬äº”ç« ï¼šæ›´æ–°æœ€ä½³å®è·µ

## ç›®å½•

- [ç°åº¦å‘å¸ƒå®Œæ•´å®ç°](#ç°åº¦å‘å¸ƒå®Œæ•´å®ç°)
- [å·®åˆ†æ›´æ–°åŸç†](#å·®åˆ†æ›´æ–°åŸç†)
- [å¼ºåˆ¶æ›´æ–°ç­–ç•¥](#å¼ºåˆ¶æ›´æ–°ç­–ç•¥)
- [é”™è¯¯å›æ»šæœºåˆ¶](#é”™è¯¯å›æ»šæœºåˆ¶)
- [ç”¨æˆ·ä½“éªŒè®¾è®¡](#ç”¨æˆ·ä½“éªŒè®¾è®¡)
- [A/B æµ‹è¯•é›†æˆ](#ab-æµ‹è¯•é›†æˆ)
- [ç›‘æ§ä¸æŠ¥è­¦](#ç›‘æ§ä¸æŠ¥è­¦)
- [å®é™…æ¡ˆä¾‹åˆ†æ](#å®é™…æ¡ˆä¾‹åˆ†æ)
- [æ·±å…¥ç†è§£](#æ·±å…¥ç†è§£)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [å®è·µå»ºè®®](#å®è·µå»ºè®®)

---

## ç°åº¦å‘å¸ƒå®Œæ•´å®ç°

### ç°åº¦ç­–ç•¥

ç°åº¦å‘å¸ƒï¼ˆGradual Rollout / Canary Releaseï¼‰æ˜¯æ§åˆ¶æ–°ç‰ˆæœ¬å½±å“èŒƒå›´çš„æ ¸å¿ƒæ‰‹æ®µã€‚

```
ç°åº¦å‘å¸ƒç­–ç•¥åˆ†ç±»ï¼š

  1. ç™¾åˆ†æ¯”ç°åº¦
     â”œâ”€â”€ 10% ç”¨æˆ·å…ˆæ”¶åˆ°æ›´æ–°
     â”œâ”€â”€ ç¡®è®¤æ— å¼‚å¸¸åæ‰©å¤§åˆ° 50%
     â””â”€â”€ æœ€ç»ˆ 100% å…¨é‡

  2. ç™½åå•ç°åº¦
     â”œâ”€â”€ å†…éƒ¨å‘˜å·¥å…ˆç”¨
     â”œâ”€â”€ ç§å­ç”¨æˆ·ç¾¤ä½“
     â””â”€â”€ ç„¶åå…¨é‡

  3. æ¸ é“ç°åº¦
     â”œâ”€â”€ canary æ¸ é“ï¼ˆæ¯æ—¥æ„å»ºï¼Œå†…éƒ¨æµ‹è¯•ï¼‰
     â”œâ”€â”€ beta æ¸ é“ï¼ˆé¢„å‘å¸ƒï¼Œå¤–éƒ¨æµ‹è¯•ï¼‰
     â””â”€â”€ stable æ¸ é“ï¼ˆæ­£å¼ç‰ˆï¼Œå…¨é‡ç”¨æˆ·ï¼‰

  4. æ¡ä»¶ç°åº¦
     â”œâ”€â”€ ç‰¹å®šæ“ä½œç³»ç»Ÿï¼ˆå¦‚å…ˆæ¨ macOSï¼‰
     â”œâ”€â”€ ç‰¹å®šåœ°åŒº
     â””â”€â”€ ç‰¹å®šç”¨æˆ·å±æ€§
```

### æœåŠ¡ç«¯å®ç°

```javascript
// update-server.js â€” ç°åº¦å‘å¸ƒæœåŠ¡

class GradualRollout {
  constructor() {
    this.config = {
      currentStable: '1.2.5',
      rollout: {
        version: '1.3.0',
        startedAt: '2024-01-20T00:00:00Z',
        rules: [
          // è§„åˆ™æŒ‰ä¼˜å…ˆçº§æ’åˆ—
          {
            type: 'whitelist',
            users: ['user-001', 'user-002', 'dev-team'],
            enabled: true,
          },
          {
            type: 'percentage',
            value: 30,        // 30% çš„ç”¨æˆ·
            enabled: true,
          },
          {
            type: 'platform',
            platforms: ['darwin'],  // å…ˆæ¨ macOS
            enabled: false,
          }
        ],
        paused: false,        // ç´§æ€¥æš‚åœå¼€å…³
        metrics: {
          crashRate: 0.02,    // å½“å‰å´©æºƒç‡
          maxCrashRate: 0.05, // è¶…è¿‡æ­¤å€¼è‡ªåŠ¨æš‚åœ
        }
      }
    }
  }

  // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åº”è¯¥æ”¶åˆ°æ›´æ–°
  shouldUpdate(userId, platform, currentVersion) {
    const { rollout } = this.config
    
    // ç´§æ€¥æš‚åœ
    if (rollout.paused) return false
    
    // å·²ç»æ˜¯æœ€æ–°ç‰ˆæˆ–æ›´æ–°ç‰ˆ
    if (this.compareVersions(currentVersion, rollout.version) >= 0) return false
    
    // æ£€æŸ¥å´©æºƒç‡
    if (rollout.metrics.crashRate > rollout.metrics.maxCrashRate) {
      console.warn('å´©æºƒç‡è¶…æ ‡ï¼Œè‡ªåŠ¨æš‚åœç°åº¦')
      rollout.paused = true
      this.alertOps('ç°åº¦è‡ªåŠ¨æš‚åœï¼šå´©æºƒç‡è¶…æ ‡')
      return false
    }
    
    // æŒ‰è§„åˆ™åŒ¹é…
    for (const rule of rollout.rules) {
      if (!rule.enabled) continue
      
      switch (rule.type) {
        case 'whitelist':
          if (rule.users.includes(userId)) return true
          break
          
        case 'percentage':
          if (this.getUserBucket(userId) < rule.value) return true
          break
          
        case 'platform':
          if (rule.platforms.includes(platform)) return true
          break
      }
    }
    
    return false
  }

  // ç”¨æˆ·åˆ†æ¡¶ï¼ˆç¡®ä¿åŒä¸€ç”¨æˆ·æ¯æ¬¡å¾—åˆ°ç›¸åŒç»“æœï¼‰
  getUserBucket(userId) {
    const hash = crypto.createHash('md5').update(userId).digest('hex')
    return parseInt(hash.substring(0, 8), 16) % 100
  }

  // ç‰ˆæœ¬æ¯”è¾ƒ
  compareVersions(v1, v2) {
    const a = v1.split('.').map(Number)
    const b = v2.split('.').map(Number)
    for (let i = 0; i < 3; i++) {
      if (a[i] > b[i]) return 1
      if (a[i] < b[i]) return -1
    }
    return 0
  }

  alertOps(message) {
    // å‘é€å‘Šè­¦åˆ°è¿ç»´æ¸ é“
    console.error('[ALERT]', message)
  }
}

// API ç«¯ç‚¹
app.get('/api/check-update', (req, res) => {
  const { userId, platform, version } = req.query
  const rollout = new GradualRollout()
  
  if (rollout.shouldUpdate(userId, platform, version)) {
    res.json({
      hasUpdate: true,
      version: rollout.config.rollout.version,
      url: `https://cdn.yourapp.com/releases/v${rollout.config.rollout.version}`,
    })
  } else {
    res.json({ hasUpdate: false })
  }
})
```

### ç°åº¦æ¨è¿›æµç¨‹

```
ç°åº¦æ¨è¿›æµç¨‹ï¼ˆå…¸å‹ 5 å¤©ï¼‰ï¼š

  Day 0: å†…éƒ¨æµ‹è¯•
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç™½åå•: å¼€å‘å›¢é˜Ÿ + QA (20äºº)     â”‚
  â”‚  è§‚å¯Ÿ: åŠŸèƒ½æ­£ç¡®æ€§ã€å´©æºƒç‡         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ OK?
           â–¼
  Day 1: ç§å­ç”¨æˆ·
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç™¾åˆ†æ¯”: 5%                        â”‚
  â”‚  è§‚å¯Ÿ: å´©æºƒç‡ < 0.5%ã€ç”¨æˆ·åé¦ˆ    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ OK?
           â–¼
  Day 2: æ‰©å¤§èŒƒå›´
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç™¾åˆ†æ¯”: 30%                       â”‚
  â”‚  è§‚å¯Ÿ: æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯æ—¥å¿—         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ OK?
           â–¼
  Day 3-4: å¤§èŒƒå›´æ¨é€
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç™¾åˆ†æ¯”: 70%                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ OK?
           â–¼
  Day 5: å…¨é‡
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç™¾åˆ†æ¯”: 100%                      â”‚
  â”‚  æ›´æ–° stable ç‰ˆæœ¬å·               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ä»»ä½•é˜¶æ®µå‘ç°é—®é¢˜:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æš‚åœç°åº¦ (paused: true)          â”‚
  â”‚  åˆ†æé—®é¢˜                         â”‚
  â”‚  ä¿®å¤åé‡æ–°å¼€å§‹ç°åº¦               â”‚
  â”‚  æˆ–å›æ»šåˆ°ä¸Šä¸€ä¸ª stable ç‰ˆæœ¬       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·®åˆ†æ›´æ–°åŸç†

### bsdiff ç®—æ³•

```
bsdiff äºŒè¿›åˆ¶å·®åˆ†ç®—æ³•ï¼š

  åŸç†ï¼š
  1. å¯¹æ—§æ–‡ä»¶è¿›è¡Œåç¼€æ’åº
  2. æ‰¾åˆ°æ–°æ–‡ä»¶å’Œæ—§æ–‡ä»¶ä¹‹é—´çš„æœ€é•¿å…¬å…±å­åºåˆ—
  3. ç”Ÿæˆ diff æ–‡ä»¶ï¼ˆåªåŒ…å«å·®å¼‚éƒ¨åˆ†ï¼‰

  æµç¨‹ï¼š
  æ—§æ–‡ä»¶ (old.bin, 100MB)
  æ–°æ–‡ä»¶ (new.bin, 102MB)
       â”‚
       â–¼
  bsdiff old.bin new.bin patch.bin
       â”‚
       â–¼
  è¡¥ä¸æ–‡ä»¶ (patch.bin, 5MB)  â† åªæœ‰å·®å¼‚éƒ¨åˆ†
       â”‚
       â–¼
  bspatch old.bin new.bin patch.bin  â† å®¢æˆ·ç«¯åˆæˆ
       â”‚
       â–¼
  æ¢å¤å‡ºå®Œæ•´çš„ new.bin

  ä¼˜åŠ¿ï¼š
  - å¯¹å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«æœ‰æ•ˆï¼ˆé€šå¸¸å‹ç¼©åˆ° 5-20%ï¼‰
  - æˆç†Ÿçš„ç®—æ³•ï¼Œè¢« Chromeã€Firefox ä½¿ç”¨

  åŠ£åŠ¿ï¼š
  - éœ€è¦æ—§æ–‡ä»¶å‚ä¸åˆæˆ
  - åˆæˆè¿‡ç¨‹ CPU å¯†é›†
  - å®¢æˆ·ç«¯å¿…é¡»æœ‰å®Œæ•´çš„æ—§ç‰ˆæœ¬
```

### blockmapï¼ˆelectron-updater ä½¿ç”¨çš„æ–¹æ¡ˆï¼‰

```
blockmap å·®åˆ†æ›´æ–°åŸç†ï¼š

  å°†æ–‡ä»¶åˆ†å‰²ä¸ºå›ºå®šå¤§å°çš„å—ï¼ˆé»˜è®¤ 64KBï¼‰ï¼š

  æ—§ç‰ˆæœ¬:
  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”‚ B1   â”‚ B2   â”‚ B3   â”‚ B4   â”‚ B5   â”‚
  â”‚ h:a1 â”‚ h:b2 â”‚ h:c3 â”‚ h:d4 â”‚ h:e5 â”‚
  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

  æ–°ç‰ˆæœ¬:
  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”‚ B1   â”‚ B2'  â”‚ B3   â”‚ B4   â”‚ B5   â”‚ B6   â”‚
  â”‚ h:a1 â”‚ h:f6 â”‚ h:c3 â”‚ h:d4 â”‚ h:e5 â”‚ h:g7 â”‚
  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

  å¯¹æ¯”:
  B1: a1==a1  â†’ è·³è¿‡ âœ“
  B2: b2!=f6  â†’ ä¸‹è½½ â†“ (64KB)
  B3: c3==c3  â†’ è·³è¿‡ âœ“
  B4: d4==d4  â†’ è·³è¿‡ âœ“
  B5: e5==e5  â†’ è·³è¿‡ âœ“
  B6: (æ–°å¢)  â†’ ä¸‹è½½ â†“ (64KB)

  æ€»ä¸‹è½½: 128KB è€Œé 384KB (6 blocks Ã— 64KB)
  èŠ‚çœ: 67%

  blockmap æ–‡ä»¶æ ¼å¼:
  {
    "version": 2,
    "files": [{
      "name": "MyApp-Setup-1.1.0.exe",
      "offset": 0,
      "checksums": [
        "a1a1a1...",   // B1 çš„ hash
        "f6f6f6...",   // B2' çš„ hash
        "c3c3c3...",   // B3 çš„ hash
        ...
      ],
      "sizes": [65536, 65536, 65536, ...]
    }]
  }
```

---

## å¼ºåˆ¶æ›´æ–°ç­–ç•¥

### æœ€ä½ç‰ˆæœ¬å·æœºåˆ¶

```javascript
// å¼ºåˆ¶æ›´æ–°çš„å®Œæ•´å®ç°

class ForceUpdateManager {
  constructor(mainWindow) {
    this.mainWindow = mainWindow
    this.checkInterval = null
  }

  async check() {
    try {
      // ä»æœåŠ¡å™¨è·å–æœ€ä½è¦æ±‚ç‰ˆæœ¬
      const response = await fetch('https://api.yourapp.com/min-version')
      const { minVersion, message, severity } = await response.json()
      
      // severity: 'critical' | 'recommended' | 'optional'
      
      const currentVersion = app.getVersion()
      
      if (this.isOlderThan(currentVersion, minVersion)) {
        switch (severity) {
          case 'critical':
            // å®‰å…¨æ¼æ´ç­‰ï¼šå¼ºåˆ¶æ›´æ–°ï¼Œæ— æ³•è·³è¿‡
            this.showCriticalUpdate(message)
            break
          case 'recommended':
            // é‡è¦æ›´æ–°ï¼šå¼ºçƒˆæ¨èï¼Œä½†å¯å»¶è¿Ÿ
            this.showRecommendedUpdate(message)
            break
          case 'optional':
            // å¯é€‰æ›´æ–°ï¼šæ¸©å’Œæé†’
            this.showOptionalUpdate(message)
            break
        }
      }
    } catch (err) {
      console.error('æ£€æŸ¥å¼ºåˆ¶æ›´æ–°å¤±è´¥:', err)
    }
  }

  showCriticalUpdate(message) {
    // æ›¿æ¢çª—å£å†…å®¹ä¸ºæ›´æ–°ç•Œé¢
    this.mainWindow.loadFile('force-update.html')
    
    // ç¦æ­¢å…³é—­ï¼ˆé™¤éé€šè¿‡ä»»åŠ¡ç®¡ç†å™¨ï¼‰
    this.mainWindow.on('close', (event) => {
      event.preventDefault()
      dialog.showMessageBoxSync(this.mainWindow, {
        type: 'warning',
        title: 'éœ€è¦æ›´æ–°',
        message: 'å½“å‰ç‰ˆæœ¬å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¿…é¡»æ›´æ–°åæ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚',
        buttons: ['çŸ¥é“äº†'],
      })
    })
    
    // è‡ªåŠ¨å¼€å§‹ä¸‹è½½
    autoUpdater.checkForUpdatesAndNotify()
    
    autoUpdater.on('update-downloaded', () => {
      // å€’è®¡æ—¶ 10 ç§’è‡ªåŠ¨å®‰è£…
      setTimeout(() => {
        autoUpdater.quitAndInstall(false, true)
      }, 10 * 1000)
    })
  }

  showRecommendedUpdate(message) {
    const result = dialog.showMessageBoxSync(this.mainWindow, {
      type: 'info',
      title: 'æ¨èæ›´æ–°',
      message: message || 'æœ‰é‡è¦æ›´æ–°å¯ç”¨',
      buttons: ['ç«‹å³æ›´æ–°', 'ç¨åæé†’'],
      defaultId: 0,
    })
    
    if (result === 0) {
      autoUpdater.checkForUpdatesAndNotify()
    } else {
      // 24 å°æ—¶åå†æé†’
      setTimeout(() => this.check(), 24 * 60 * 60 * 1000)
    }
  }

  showOptionalUpdate(message) {
    // åªæ˜¾ç¤ºéä¾µå…¥å¼é€šçŸ¥
    new Notification({
      title: 'æœ‰æ–°ç‰ˆæœ¬å¯ç”¨',
      body: message || 'ç‚¹å‡»æŸ¥çœ‹æ›´æ–°è¯¦æƒ…',
    }).show()
  }

  isOlderThan(v1, v2) {
    const a = v1.split('.').map(Number)
    const b = v2.split('.').map(Number)
    for (let i = 0; i < 3; i++) {
      if (a[i] < b[i]) return true
      if (a[i] > b[i]) return false
    }
    return false
  }
}
```

---

## é”™è¯¯å›æ»šæœºåˆ¶

### å¤šå±‚å›æ»šç­–ç•¥

```
å›æ»šæœºåˆ¶å…¨æ™¯ï¼š

  Layer 1: è‡ªåŠ¨å›æ»šï¼ˆå´©æºƒæ£€æµ‹ï¼‰
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ–°ç‰ˆæœ¬å¯åŠ¨å 30 ç§’å†…å´©æºƒ 2 æ¬¡ â†’ è‡ªåŠ¨æ¢å¤æ—§ç‰ˆæœ¬    â”‚
  â”‚  å®ç°: sentinel æ–‡ä»¶ + å´©æºƒè®¡æ•°                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 2: ç”¨æˆ·è§¦å‘å›æ»š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ç”¨æˆ·åœ¨è®¾ç½®ä¸­æ‰‹åŠ¨é€‰æ‹© "å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬"             â”‚
  â”‚  å®ç°: ä¿ç•™æ—§ç‰ˆæœ¬æ–‡ä»¶ + ä¸€é”®åˆ‡æ¢                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 3: æœåŠ¡ç«¯å›æ»š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¿ç»´å°† latest.yml æŒ‡å‘æ—§ç‰ˆæœ¬                       â”‚
  â”‚  æ‰€æœ‰ç”¨æˆ·ä¸‹æ¬¡æ£€æŸ¥æ›´æ–°æ—¶ "æ›´æ–°" åˆ°æ—§ç‰ˆæœ¬             â”‚
  â”‚  å®ç°: ä¿®æ”¹æ›´æ–°æœåŠ¡å™¨é…ç½®                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 4: ç´§æ€¥çƒ­ä¿®å¤
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ä¸å›æ»šï¼Œè€Œæ˜¯å¿«é€Ÿå‘å¸ƒä¿®å¤ç‰ˆæœ¬                       â”‚
  â”‚  é€šè¿‡å¼ºåˆ¶æ›´æ–°æ¨é€åˆ°æ‰€æœ‰ç”¨æˆ·                         â”‚
  â”‚  å®ç°: ç´§æ€¥å‘å¸ƒæµç¨‹ + å¼ºåˆ¶æ›´æ–°                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è‡ªåŠ¨å›æ»šå®ç°

```javascript
// auto-rollback.js

const SENTINEL_PATH = path.join(app.getPath('userData'), '.update-sentinel')
const MAX_CRASHES = 2
const STABILITY_WINDOW = 30000 // 30ç§’

class AutoRollback {
  constructor(bundleManager) {
    this.bm = bundleManager
  }

  onAppStart() {
    const sentinel = this.readSentinel()
    
    if (!sentinel) return // æ²¡æœ‰å¾…éªŒè¯çš„æ›´æ–°
    
    if (sentinel.status === 'verifying') {
      sentinel.launches = (sentinel.launches || 0) + 1
      
      if (sentinel.launches > MAX_CRASHES) {
        // è¿ç»­å´©æºƒå¤ªå¤šæ¬¡ï¼Œå›æ»š
        console.error('æ£€æµ‹åˆ°æ›´æ–°åè¿ç»­å´©æºƒï¼Œæ‰§è¡Œå›æ»š')
        this.performRollback(sentinel)
        return
      }
      
      // æ›´æ–°å¯åŠ¨è®¡æ•°
      this.writeSentinel(sentinel)
      
      // å¯åŠ¨ç¨³å®šæ€§è®¡æ—¶å™¨
      setTimeout(() => {
        // å¦‚æœ 30 ç§’åè¿˜åœ¨è¿è¡Œï¼Œæ ‡è®°ä¸ºç¨³å®š
        sentinel.status = 'stable'
        sentinel.launches = 0
        this.writeSentinel(sentinel)
        console.log('æ›´æ–°éªŒè¯é€šè¿‡ï¼Œç‰ˆæœ¬ç¨³å®š')
        
        // æ¸…ç†æ—§ç‰ˆæœ¬å¤‡ä»½
        this.bm.cleanup(2)
      }, STABILITY_WINDOW)
    }
  }

  onUpdateApplied(version) {
    this.writeSentinel({
      version,
      status: 'verifying',
      launches: 0,
      appliedAt: Date.now(),
    })
  }

  performRollback(sentinel) {
    console.warn(`å›æ»š: v${sentinel.version} â†’ ä¸Šä¸€ä¸ªç‰ˆæœ¬`)
    
    const previousPath = this.bm.rollback()
    
    // æ¸…é™¤ sentinel
    fs.unlinkSync(SENTINEL_PATH)
    
    // ä¸ŠæŠ¥å›æ»šäº‹ä»¶
    this.reportRollback(sentinel)
    
    // é‡å¯åº”ç”¨
    app.relaunch()
    app.exit(0)
  }

  reportRollback(sentinel) {
    // ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ
    fetch('https://api.yourapp.com/telemetry/rollback', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        version: sentinel.version,
        launches: sentinel.launches,
        platform: process.platform,
        arch: process.arch,
      })
    }).catch(() => {})
  }

  readSentinel() {
    try {
      return JSON.parse(fs.readFileSync(SENTINEL_PATH, 'utf-8'))
    } catch {
      return null
    }
  }

  writeSentinel(data) {
    fs.writeFileSync(SENTINEL_PATH, JSON.stringify(data))
  }
}
```

---

## ç”¨æˆ·ä½“éªŒè®¾è®¡

### æ›´æ–° UI è®¾è®¡åŸåˆ™

```
å¥½çš„æ›´æ–°ä½“éªŒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  1. ä¸æ‰“æ–­ç”¨æˆ·å·¥ä½œæµ                                â”‚
â”‚     âœ… åå°ä¸‹è½½ï¼Œå®Œæˆåæ¸©å’Œé€šçŸ¥                     â”‚
â”‚     âŒ å¼¹çª—é˜»æ–­ï¼Œå¼ºåˆ¶ç”¨æˆ·ç«‹å³å†³å®š                   â”‚
â”‚                                                      â”‚
â”‚  2. é€æ˜å‘ŠçŸ¥                                        â”‚
â”‚     âœ… æ¸…æ¥šå±•ç¤ºæ›´æ–°å†…å®¹ã€å¤§å°ã€é¢„è®¡æ—¶é—´             â”‚
â”‚     âŒ åªè¯´"æœ‰æ›´æ–°"ä¸è¯´æ›´æ–°äº†ä»€ä¹ˆ                   â”‚
â”‚                                                      â”‚
â”‚  3. ç»™äºˆæ§åˆ¶æƒ                                      â”‚
â”‚     âœ… "ç¨åæé†’" / "ä¸‹æ¬¡å¯åŠ¨æ—¶å®‰è£…"                â”‚
â”‚     âŒ åªæœ‰ "ç«‹å³å®‰è£…" ä¸€ä¸ªé€‰é¡¹                     â”‚
â”‚                                                      â”‚
â”‚  4. è¿›åº¦å¯è§                                        â”‚
â”‚     âœ… ä¸‹è½½è¿›åº¦ã€é€Ÿåº¦ã€å‰©ä½™æ—¶é—´                     â”‚
â”‚     âŒ è½¬åœˆåœˆï¼Œä¸çŸ¥é“è¦ç­‰å¤šä¹…                       â”‚
â”‚                                                      â”‚
â”‚  5. ä¼˜é›…é™çº§                                        â”‚
â”‚     âœ… ç½‘ç»œæ–­å¼€æ—¶é™é»˜é‡è¯•ï¼Œä¸æŠ¥é”™                   â”‚
â”‚     âŒ å¼¹å‡ºæŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯                           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ›´æ–°é€šçŸ¥ç±»å‹

```
é€šçŸ¥ç±»å‹ä¸åœºæ™¯ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ åœºæ™¯ 1: åå°ä¸‹è½½å®Œæˆ                               â”‚
  â”‚                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ ğŸ”„ æ›´æ–°å°±ç»ª                         â”‚           â”‚
  â”‚  â”‚                                      â”‚           â”‚
  â”‚  â”‚ v1.3.0 å·²ä¸‹è½½å®Œæˆ                    â”‚           â”‚
  â”‚  â”‚ åŒ…å« 3 é¡¹æ”¹è¿›å’Œ 5 ä¸ª bug ä¿®å¤        â”‚           â”‚
  â”‚  â”‚                                      â”‚           â”‚
  â”‚  â”‚ [ä¸‹æ¬¡å¯åŠ¨æ—¶å®‰è£…]  [æŸ¥çœ‹è¯¦æƒ…]          â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ åœºæ™¯ 2: æ­£åœ¨ä¸‹è½½                                   â”‚
  â”‚                                                     â”‚
  â”‚  çŠ¶æ€æ å°å›¾æ ‡:                                     â”‚
  â”‚  â¬‡ ä¸‹è½½æ›´æ–° 45% (2.3 MB/s)                        â”‚
  â”‚  ä¸å¼¹çª—ï¼Œä¸æ‰“æ–­                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ åœºæ™¯ 3: å¼ºåˆ¶æ›´æ–°                                   â”‚
  â”‚                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ âš ï¸ éœ€è¦æ›´æ–°                         â”‚           â”‚
  â”‚  â”‚                                      â”‚           â”‚
  â”‚  â”‚ å½“å‰ç‰ˆæœ¬å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå¿…é¡»æ›´æ–°å     â”‚           â”‚
  â”‚  â”‚ æ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚                        â”‚           â”‚
  â”‚  â”‚                                      â”‚           â”‚
  â”‚  â”‚ æ­£åœ¨ä¸‹è½½... 67%                       â”‚           â”‚
  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘             â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## A/B æµ‹è¯•é›†æˆ

```javascript
// A/B æµ‹è¯•ä¸æ›´æ–°ç»“åˆ

// æœåŠ¡ç«¯: ä¸åŒç”¨æˆ·ç»„æ”¶åˆ°ä¸åŒç‰ˆæœ¬
{
  "experiments": {
    "new-editor": {
      "control": {
        "version": "1.2.5",
        "percentage": 50
      },
      "treatment": {
        "version": "1.3.0-experiment.1",
        "percentage": 50
      }
    }
  }
}

// å®¢æˆ·ç«¯: ä¸ŠæŠ¥å®éªŒæ•°æ®
class ABTestUpdater {
  constructor(userId) {
    this.userId = userId
    this.experimentGroup = this.getExperimentGroup()
  }

  getExperimentGroup() {
    // æ ¹æ® userId hash ç¡®å®šåˆ†ç»„
    const hash = crypto.createHash('md5').update(this.userId).digest('hex')
    const bucket = parseInt(hash.substring(0, 8), 16) % 100
    return bucket < 50 ? 'control' : 'treatment'
  }

  async checkUpdate() {
    const response = await fetch(
      `${serverUrl}/check-update?` +
      `userId=${this.userId}&` +
      `group=${this.experimentGroup}&` +
      `version=${app.getVersion()}`
    )
    return response.json()
  }

  // ä¸ŠæŠ¥æŒ‡æ ‡ï¼ˆæ›´æ–°åçš„è¡Œä¸ºæ•°æ®ï¼‰
  reportMetric(event, data) {
    fetch(`${serverUrl}/telemetry`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId: this.userId,
        group: this.experimentGroup,
        version: app.getVersion(),
        event,
        data,
        timestamp: Date.now(),
      })
    }).catch(() => {})
  }
}
```

---

## ç›‘æ§ä¸æŠ¥è­¦

### å…³é”®æŒ‡æ ‡

```
æ›´æ–°ç›¸å…³çš„å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                      â”‚
  â”‚  1. æ›´æ–°è¦†ç›–ç‡                                      â”‚
  â”‚     - å„ç‰ˆæœ¬ç”¨æˆ·æ•°é‡å’Œæ¯”ä¾‹                          â”‚
  â”‚     - æœ€æ–°ç‰ˆæœ¬çš„è¦†ç›–ç‡éšæ—¶é—´å˜åŒ–                    â”‚
  â”‚     - ç›®æ ‡: å‘å¸ƒå 7 å¤©è¦†ç›– 90%                     â”‚
  â”‚                                                      â”‚
  â”‚  2. æ›´æ–°æˆåŠŸç‡                                      â”‚
  â”‚     - æ£€æŸ¥æˆåŠŸç‡ (ç½‘ç»œ/æœåŠ¡å™¨é—®é¢˜)                  â”‚
  â”‚     - ä¸‹è½½æˆåŠŸç‡ (ç½‘ç»œä¸­æ–­/ç£ç›˜ç©ºé—´)                â”‚
  â”‚     - å®‰è£…æˆåŠŸç‡ (æƒé™/æ–‡ä»¶é”å®š)                    â”‚
  â”‚     - ç›®æ ‡: > 99%                                   â”‚
  â”‚                                                      â”‚
  â”‚  3. å´©æºƒç‡                                          â”‚
  â”‚     - å„ç‰ˆæœ¬çš„å´©æºƒç‡                                â”‚
  â”‚     - æ›´æ–°å vs æ›´æ–°å‰çš„å´©æºƒç‡å¯¹æ¯”                  â”‚
  â”‚     - ç›®æ ‡: < 0.5%                                  â”‚
  â”‚                                                      â”‚
  â”‚  4. å›æ»šç‡                                          â”‚
  â”‚     - è‡ªåŠ¨å›æ»šæ¬¡æ•°                                  â”‚
  â”‚     - ç”¨æˆ·æ‰‹åŠ¨å›æ»šæ¬¡æ•°                              â”‚
  â”‚     - ç›®æ ‡: < 1%                                    â”‚
  â”‚                                                      â”‚
  â”‚  5. æ€§èƒ½æŒ‡æ ‡                                        â”‚
  â”‚     - æ›´æ–°åŒ…ä¸‹è½½è€—æ—¶                                â”‚
  â”‚     - æ›´æ–°å®‰è£…è€—æ—¶                                  â”‚
  â”‚     - æ›´æ–°åé¦–æ¬¡å¯åŠ¨è€—æ—¶                            â”‚
  â”‚                                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¥æµ‹å®ç°

```javascript
// telemetry.js â€” æ›´æ–°é¥æµ‹

class UpdateTelemetry {
  constructor(serverUrl) {
    this.serverUrl = serverUrl
    this.sessionId = crypto.randomUUID()
  }

  // ä¸ŠæŠ¥äº‹ä»¶
  async report(event, data = {}) {
    try {
      await fetch(`${this.serverUrl}/telemetry`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          sessionId: this.sessionId,
          event,
          data: {
            ...data,
            version: app.getVersion(),
            platform: process.platform,
            arch: process.arch,
            locale: app.getLocale(),
          },
          timestamp: new Date().toISOString(),
        })
      })
    } catch {
      // é¥æµ‹å¤±è´¥ä¸åº”å½±å“åº”ç”¨
    }
  }

  // é¢„å®šä¹‰äº‹ä»¶
  updateCheckStarted() { this.report('update.check.started') }
  updateCheckFailed(error) { this.report('update.check.failed', { error }) }
  updateAvailable(version) { this.report('update.available', { version }) }
  updateNotAvailable() { this.report('update.not_available') }
  downloadStarted(version) { this.report('update.download.started', { version }) }
  downloadProgress(percent) { this.report('update.download.progress', { percent }) }
  downloadCompleted(version, duration) {
    this.report('update.download.completed', { version, duration })
  }
  downloadFailed(error) { this.report('update.download.failed', { error }) }
  installStarted(version) { this.report('update.install.started', { version }) }
  installCompleted(version) { this.report('update.install.completed', { version }) }
  installFailed(error) { this.report('update.install.failed', { error }) }
  rollbackTriggered(fromVersion, toVersion) {
    this.report('update.rollback', { fromVersion, toVersion })
  }
}
```

### æŠ¥è­¦è§„åˆ™

```
æŠ¥è­¦è§„åˆ™é…ç½®ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è§„åˆ™ 1: å´©æºƒç‡çªå¢                                  â”‚
  â”‚  æ¡ä»¶: æœ€æ–°ç‰ˆæœ¬å´©æºƒç‡ > 2% ä¸”æŒç»­ 10 åˆ†é’Ÿ           â”‚
  â”‚  åŠ¨ä½œ: æš‚åœç°åº¦ + é€šçŸ¥å¼€å‘å›¢é˜Ÿ                      â”‚
  â”‚  çº§åˆ«: P1 (ç´§æ€¥)                                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è§„åˆ™ 2: æ›´æ–°æˆåŠŸç‡ä¸‹é™                              â”‚
  â”‚  æ¡ä»¶: æ›´æ–°æˆåŠŸç‡ < 95% ä¸”æŒç»­ 30 åˆ†é’Ÿ              â”‚
  â”‚  åŠ¨ä½œ: æ£€æŸ¥æ›´æ–°æœåŠ¡å™¨çŠ¶æ€                            â”‚
  â”‚  çº§åˆ«: P2 (é«˜)                                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è§„åˆ™ 3: å›æ»šç‡å¼‚å¸¸                                  â”‚
  â”‚  æ¡ä»¶: å›æ»šç‡ > 5%                                   â”‚
  â”‚  åŠ¨ä½œ: æš‚åœç°åº¦ + é€šçŸ¥å¼€å‘å›¢é˜Ÿ                      â”‚
  â”‚  çº§åˆ«: P1 (ç´§æ€¥)                                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è§„åˆ™ 4: ç‰ˆæœ¬ç¢ç‰‡åŒ–                                  â”‚
  â”‚  æ¡ä»¶: å‘å¸ƒ 14 å¤©åæœ€æ–°ç‰ˆè¦†ç›–ç‡ < 50%               â”‚
  â”‚  åŠ¨ä½œ: æ£€æŸ¥æ›´æ–°æ¨é€ç­–ç•¥                              â”‚
  â”‚  çº§åˆ«: P3 (ä¸­)                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ 1: VS Code çš„æ›´æ–°ç­–ç•¥

```
VS Code æ›´æ–°æ–¹æ¡ˆ:

  1. ä½¿ç”¨ electron-updater + GitHub Releases
  2. ç¨³å®šç‰ˆæœˆæ›´ï¼ŒInsiders ç‰ˆæ—¥æ›´
  3. èƒŒæ™¯é™é»˜ä¸‹è½½
  4. ä¸‹è½½å®Œæˆååœ¨çŠ¶æ€æ æç¤º "é‡å¯ä»¥æ›´æ–°"
  5. ç”¨æˆ·å¯ä»¥éšæ—¶ç‚¹å‡»é‡å¯ï¼Œä¹Ÿå¯ä»¥ç»§ç»­å·¥ä½œ
  6. ä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨å®‰è£…

  äº®ç‚¹:
  - æ‰©å±•ç³»ç»Ÿç‹¬ç«‹äºåº”ç”¨æ›´æ–°
  - è®¾ç½®åŒæ­¥å‡å°‘é‡æ–°é…ç½®æˆæœ¬
  - å‘è¡Œè¯´æ˜æ¸…æ™°è¯¦å°½
```

### æ¡ˆä¾‹ 2: Slack çš„æ›´æ–°ç­–ç•¥

```
Slack æ›´æ–°æ–¹æ¡ˆ:

  1. é™é»˜è‡ªåŠ¨æ›´æ–°
  2. ç”¨æˆ·å‡ ä¹æ— æ„ŸçŸ¥
  3. ä¸‹è½½å®Œæˆåç­‰å¾…ç”¨æˆ·ç©ºé—²
  4. åœ¨ç©ºé—²æ—¶è‡ªåŠ¨é‡å¯æ›´æ–°
  5. é‡å¯åæ¢å¤åˆ°ä¹‹å‰çš„å·¥ä½œçŠ¶æ€

  äº®ç‚¹:
  - æä½çš„ç”¨æˆ·æ‰“æ‰°
  - çŠ¶æ€ä¿æŒå’Œæ¢å¤
  - å¿«é€Ÿçš„æ›´æ–°èŠ‚å¥
```

### æ¡ˆä¾‹ 3: å›½å†…åº”ç”¨çš„æ··åˆæ–¹æ¡ˆ

```
å…¸å‹å›½å†… Electron åº”ç”¨:

  1. å£³å±‚æ›´æ–°: electron-updater
     - ä½é¢‘ (æ¯æœˆ)
     - é™é»˜ä¸‹è½½ + ä¸‹æ¬¡å¯åŠ¨å®‰è£…

  2. å‰ç«¯çƒ­æ›´æ–°: Web Bundle / asar æ›¿æ¢
     - é«˜é¢‘ (æ¯å‘¨ç”šè‡³æ¯å¤©)
     - é€šè¿‡ç°åº¦é€æ­¥æ¨é€
     - ä¸éœ€è¦é‡å¯

  3. å¼ºåˆ¶æ›´æ–°: æœ€ä½ç‰ˆæœ¬å·æ§åˆ¶
     - å®‰å…¨æ¼æ´æ—¶è§¦å‘
     - å¿…é¡»æ›´æ–°æ‰èƒ½ä½¿ç”¨

  4. CDN åŠ é€Ÿ: é˜¿é‡Œäº‘ OSS / è…¾è®¯ COS
     - å›½å†…è®¿é—®é€Ÿåº¦å¿«
     - æˆæœ¬å¯æ§
```

---

## æ·±å…¥ç†è§£

### æ›´æ–°ç­–ç•¥çš„æ€»ä½“æ¶æ„

```
å®Œæ•´çš„æ›´æ–°æ¶æ„ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                     æ›´æ–°æœåŠ¡                             â”‚
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚ å…¨é‡æ›´æ–°  â”‚  â”‚ çƒ­è¡¥ä¸   â”‚  â”‚ ç°åº¦/A-B æµ‹è¯•æ§åˆ¶   â”‚ â”‚
  â”‚  â”‚ æœåŠ¡     â”‚  â”‚ æœåŠ¡     â”‚  â”‚ æœåŠ¡                  â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚       â”‚              â”‚                    â”‚              â”‚
  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚                      â”‚                                    â”‚
  â”‚              CDN åˆ†å‘å±‚                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    HTTPS ä¸‹è½½
                         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      â–¼                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚              UpdateManager                        â”‚   â”‚
  â”‚  â”‚                                                    â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
  â”‚  â”‚  â”‚ electron â”‚ â”‚ asar     â”‚ â”‚ web bundle       â”‚  â”‚   â”‚
  â”‚  â”‚  â”‚ -updater â”‚ â”‚ patcher  â”‚ â”‚ manager          â”‚  â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
  â”‚  â”‚                                                    â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
  â”‚  â”‚  â”‚ å›æ»š     â”‚ â”‚ ç°åº¦     â”‚ â”‚ é¥æµ‹ä¸ŠæŠ¥         â”‚  â”‚   â”‚
  â”‚  â”‚  â”‚ ç®¡ç†å™¨   â”‚ â”‚ å®¢æˆ·ç«¯   â”‚ â”‚                   â”‚  â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                     Electron App                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¸¸è§é—®é¢˜

### Q1: ç°åº¦å‘å¸ƒå¦‚ä½•ç¡®ä¿ç”¨æˆ·åˆ†ç»„ä¸€è‡´ï¼Ÿ

ä½¿ç”¨ç”¨æˆ· ID çš„ hash åˆ†æ¡¶ï¼Œè€Œä¸æ˜¯éšæœºæ•°ã€‚è¿™æ ·åŒä¸€ç”¨æˆ·æ¯æ¬¡æ£€æŸ¥æ›´æ–°æ—¶éƒ½å±äºåŒä¸€ä¸ªåˆ†ç»„ã€‚

### Q2: å·®åˆ†æ›´æ–°å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

å›é€€åˆ°å…¨é‡ä¸‹è½½ã€‚å·®åˆ†æ›´æ–°æ˜¯ä¼˜åŒ–æ‰‹æ®µï¼Œä¸æ˜¯å¿…é¡»è·¯å¾„ã€‚

### Q3: å¦‚ä½•å¤„ç†ç”¨æˆ·é•¿æœŸä¸æ›´æ–°ï¼Ÿ

è®¾ç½®æœ€ä½ç‰ˆæœ¬å·ã€‚ä½äºæœ€ä½ç‰ˆæœ¬çš„ç”¨æˆ·åœ¨å¯åŠ¨æ—¶ä¼šè¢«å¼ºåˆ¶æ›´æ–°ã€‚

### Q4: æ›´æ–°è¿‡ç¨‹ä¸­æ–­ç”µ/å´©æºƒæ€ä¹ˆåŠï¼Ÿ

- ä¸‹è½½ä¸­æ–­ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ 
- å®‰è£…ä¸­æ–­ï¼šä½¿ç”¨åŸå­æ“ä½œï¼ˆrenameï¼‰ï¼Œè¦ä¹ˆå®Œå…¨æˆåŠŸè¦ä¹ˆä¸å½±å“æ—§ç‰ˆæœ¬
- å¯åŠ¨å¤±è´¥ï¼šsentinel æœºåˆ¶è‡ªåŠ¨å›æ»š

### Q5: å¤šä¸ªæ›´æ–°æ–¹æ¡ˆå¦‚ä½•åè°ƒï¼Ÿ

```
ä¼˜å…ˆçº§å’Œäº’æ–¥å…³ç³»ï¼š

  electron-updater (å…¨é‡) â€” æœ€ä½é¢‘ï¼Œæœ€é«˜ä¼˜å…ˆçº§
  asar çƒ­è¡¥ä¸            â€” ä¸­é¢‘ï¼Œå£³ç‰ˆæœ¬å…¼å®¹æ—¶ä½¿ç”¨
  web bundle æ›´æ–°        â€” æœ€é«˜é¢‘ï¼Œå£³ç‰ˆæœ¬å…¼å®¹æ—¶ä½¿ç”¨

  è§„åˆ™ï¼š
  - å…¨é‡æ›´æ–°æ—¶ï¼Œæ¸…é™¤æ‰€æœ‰çƒ­è¡¥ä¸å’Œ bundle ç¼“å­˜
  - asar è¡¥ä¸åï¼Œéœ€è¦æ£€æŸ¥ web bundle å…¼å®¹æ€§
  - web bundle æ›´æ–°ç‹¬ç«‹äºå…¶ä»–ä¸¤ç§
```

---

## å®è·µå»ºè®®

### 1. èµ·æ­¥æ–¹æ¡ˆ

```
åˆšå¼€å§‹åšæ›´æ–°ï¼ŸæŒ‰è¿™ä¸ªé¡ºåºï¼š

  Phase 1: åŸºç¡€ (Week 1)
  â””â”€â”€ electron-updater + GitHub Releases
      æœ€ç®€å•ï¼Œè¦†ç›– 80% çš„éœ€æ±‚

  Phase 2: ä¼˜åŒ– (Month 1)
  â””â”€â”€ æ·»åŠ ç°åº¦å‘å¸ƒï¼ˆç™¾åˆ†æ¯”ç°åº¦ï¼‰
      æ·»åŠ æ›´æ–°é¥æµ‹
      æ·»åŠ å›æ»šæœºåˆ¶

  Phase 3: çƒ­æ›´æ–° (Month 2-3)
  â””â”€â”€ Web Bundle ç‹¬ç«‹æ›´æ–°
      å¢é‡ä¸‹è½½
      CDN åŠ é€Ÿ

  Phase 4: ç”Ÿäº§åŒ– (Month 3+)
  â””â”€â”€ A/B æµ‹è¯•
      å®Œæ•´ç›‘æ§æŠ¥è­¦
      è‡ªåŠ¨ç°åº¦æ¨è¿›
```

### 2. å®‰å…¨æ¸…å•

```
â–¡ æ‰€æœ‰ä¸‹è½½ä½¿ç”¨ HTTPS
â–¡ æ–‡ä»¶ SHA256 æ ¡éªŒ
â–¡ ä»£ç ç­¾åï¼ˆmacOS/Windowsï¼‰
â–¡ ä¸å…è®¸ç‰ˆæœ¬é™çº§ï¼ˆé˜²å›æ»šæ”»å‡»ï¼‰
â–¡ æ›´æ–°æœåŠ¡å™¨çš„è®¿é—®æ§åˆ¶
â–¡ manifest ç­¾åéªŒè¯
â–¡ å®šæœŸå®‰å…¨å®¡è®¡
```

### 3. è¿ç»´æ¸…å•

```
å‘å¸ƒå‰ï¼š
â–¡ æ„å»ºæ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…
â–¡ ç­¾åæ ¡éªŒ
â–¡ æµ‹è¯•å‡çº§è·¯å¾„ï¼ˆè‡³å°‘ 2 ä¸ªæ—§ç‰ˆæœ¬ï¼‰
â–¡ å‡†å¤‡ release notes
â–¡ ç°åº¦è§„åˆ™é…ç½®

å‘å¸ƒä¸­ï¼š
â–¡ ä¸Šä¼ åˆ° CDN / GitHub Releases
â–¡ æ›´æ–° manifest.json
â–¡ å¼€å§‹ç°åº¦ï¼ˆ10%ï¼‰
â–¡ ç›‘æ§å´©æºƒç‡å’Œé”™è¯¯æ—¥å¿—

å‘å¸ƒåï¼š
â–¡ é€æ­¥æ‰©å¤§ç°åº¦
â–¡ æŒç»­ç›‘æ§ 7 å¤©
â–¡ ç¡®è®¤è¦†ç›–ç‡è¾¾æ ‡
â–¡ æ¸…ç†æ—§ç‰ˆæœ¬
```

---

## æœ¬ç« å°ç»“

æœ¬ç« æ±‡æ€»äº† Electron åº”ç”¨æ›´æ–°çš„æ‰€æœ‰æœ€ä½³å®è·µï¼š

1. **ç°åº¦å‘å¸ƒ**ï¼šç™¾åˆ†æ¯” + ç™½åå• + æ¸ é“ï¼Œé€æ­¥æ¨è¿›
2. **å·®åˆ†æ›´æ–°**ï¼šblockmap / bsdiff å‡å°‘ä¸‹è½½é‡
3. **å¼ºåˆ¶æ›´æ–°**ï¼šæœ€ä½ç‰ˆæœ¬å·ä¿éšœå®‰å…¨
4. **è‡ªåŠ¨å›æ»š**ï¼šsentinel æœºåˆ¶æ£€æµ‹å´©æºƒå¹¶æ¢å¤
5. **ç”¨æˆ·ä½“éªŒ**ï¼šåå°ä¸‹è½½ã€æ¸©å’Œé€šçŸ¥ã€ç»™äºˆæ§åˆ¶æƒ
6. **ç›‘æ§æŠ¥è­¦**ï¼šè¦†ç›–ç‡ã€æˆåŠŸç‡ã€å´©æºƒç‡ã€å›æ»šç‡
7. **A/B æµ‹è¯•**ï¼šæ•°æ®é©±åŠ¨çš„ç‰ˆæœ¬å†³ç­–

è‡³æ­¤ï¼ŒPart 2ï¼ˆçƒ­æ›´æ–°ï¼‰å…¨éƒ¨å®Œæˆã€‚æŒæ¡è¿™äº›çŸ¥è¯†ï¼Œä½ å¯ä»¥ä¸º Electron åº”ç”¨æ„å»ºä¸€å¥—ç”Ÿäº§çº§çš„æ›´æ–°ç³»ç»Ÿã€‚

---

> **ä¸Šä¸€ç¯‡**ï¼š[04 - Web Bundle æ›´æ–°](./04-web-bundle-update.md)  
> **ä¸‹ä¸€ç¯‡**ï¼š[Part 3: OpenClaw Desktop æ¶æ„](../03-openclaw-desktop/01-architecture.md)
